/*
 2013 Jason Mulligan
 @license BSD-3 <https://raw.github.com/avoidwork/abaaso/master/LICENSE>
 @link http://abaaso.com
 @module abaaso
 @version 3.8.16
*/
(function(D){var x=D.document,O=D.location,E=D.navigator,w="undefined"!==typeof exports,B,M,U,V,ba;void 0===D.abaaso&&(w&&(ba=require("url"),U=require("http"),V=require("https"),mongodb=require("mongodb").MongoClient,format=require("util").format,"undefined"===typeof Storage&&(localStorage=require("localStorage")),"undefined"===typeof XMLHttpRequest&&(XMLHttpRequest=null)),M=function(){function W(a){this.autosave=!1;this.callback=null;this.collections=[];this.crawled=!1;this.credentials=null;this.datalists=
[];this.depth=0;this.events=!0;this.expires=null;this.headers={Accept:"application/json"};this.ignore=[];this.key=null;this.keys={};this.leafs=[];this.loaded=!1;this.maxDepth=0;this.mongodb="";this.parentNode=a;this.pointer=null;this.records=[];this.retrieve=this.recursive=!1;this.source=null;this.total=0;this.views={};this.uri=null}function X(a,b,c){this.callback=null;this.element=a;this.emptyMsg="Nothing to display";this.filter=null;this.id=g.genId();this.pageIndex=1;this.pageSize=null;this.pageRange=
5;this.pagination="bottom";this.order=this.placeholder="";this.records=[];this.template=c;this.total=0;this.sensitivity="ci";this.store=b;this.where=null}function Y(){var a=this;this.promise=z.factory();this.onDone=[];this.onAlways=[];this.onFail=[];this.promise.then(function(b){z.delay(function(){f.each(a.onDone,function(a){a(b)});f.each(a.onAlways,function(a){a(b)});a.onAlways=[];a.onDone=[];a.onFail=[]})},function(b){z.delay(function(){f.each(a.onFail,function(a){a(b)});f.each(a.onAlways,function(a){a(b)});
a.onAlways=[];a.onDone=[];a.onFail=[]})})}function Z(a,b,c){this.element=a;this.datalist=b;this.debounce=c;this.filters={}}function $(a,b,c,d,e,k){var n;void 0===e||l.isEmpty(e.order)||(n=l.explode(e.order).map(function(a){return a.replace(q.after_space,"")}));this.element=a;this.fields=c;this.filter=null;this.filtered=!0===k;this.initialized=!1;this.list=null;this.options=e||{};this.store=b;this.sortable=d||[];this.sortOrder=n||d||[]}function aa(){this.cache={};this.max=1E3;this.last=this.first=
null;this.length=0}function ca(a){this.previous=this.next=null;this.value=a}function Q(){this.childNodes=[];this.error=[];this.fulfill=[];this.outcome=this.parentNode=null;this.state=z.state.pending}var da,q={after_space:/\s+.*/,android:/android/i,allow:/^allow$/i,allow_cors:/^access-control-allow-methods$/i,alphanum:/^[a-zA-Z0-9]+$/,and:/^&/,asc:/\s+asc$/ig,auth:/\/\/(.*)\@/,blackberry:/blackberry/i,"boolean":/^(true|false)?$/,boolean_number_string:/boolean|number|string/,cdata:/\&|<|>|\"|\'|\t|\r|\n|\@|\$/,
checked_disabled:/checked|disabled/i,chrome:/chrome/i,complete_loaded:/^(complete|loaded)$/i,csv_quote:/^\s|\"|\n|,|\s$/,del:/^del/,decimal:/^\d+.(\d+)/,desc:/\s+desc$/i,domain:/^[\w.-_]+\.[A-Za-z]{2,}$/,double_slash:/\/\//,down:/down/,down_up:/down|up/,email:/^[a-zA-Z0-9.!#$%&'*+\/=?\^_`{|}~\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,253}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,253}[a-zA-Z0-9])?)*$/,endslash:/\/$/,element_update:/innerHTML|innerText|textContent|type|src/,firefox:/firefox/i,get_headers:/^(head|get|options)$/,
get_remove_set:/get|remove|set/,hash:/^\#/,hash_bang:/^\#\!?/,header_replace:/:.*/,header_value_replace:/.*:\s+/,http_body:/200|202|203|206/,http_ports:/80|443/,ie:/msie|ie/i,input_button:/button|submit|reset/,integer:/(^-?\d\d*$)/,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,is_xml:/^<\?xml.*\?>/,ios:/ipad|iphone/i,json_maybe:/json|plain|javascript/,json_wrap:/^[\[\{]/,jsonp_wrap:/([a-zA-Z0-9\.]+\()(.*)(\))$/,linux:/linux|bsd|unix/i,no:/no/i,not_endpoint:/.*\//,
notEmpty:/\w{1,}/,number:/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)|number/,number_format_1:/.*\./,number_format_2:/\..*/,number_present:/\d{1,}/,number_string:/number|string/i,number_string_object:/number|object|string/i,null_undefined:/null|undefined/,observer_allowed:/click|error|key|mousedown|mouseup|submit/i,observer_globals:/body|document|window/i,object_type:/\[object Object\]/,object_undefined:/object|undefined/,opera:/opera/i,osx:/macintosh/i,patch:/^patch$/,phone:/^([0-9\(\)\/\+ \-\.]+)$/,
playbook:/playbook/i,plural:/s$/,priv:/private/,put_post:/^(post|put)$/i,radio_checkbox:/^(radio|checkbox)$/i,reflect:/function\s+\w*\s*\((.*?)\)/,root:/^\/[^\/]/,route_nget:/^(head|options)$/i,route_methods:/^(all|delete|get|put|post|head|options)$/i,safari:/safari/i,scheme:/.*\/\//,select:/select/i,selector_is:/^:/,selector_many:/\:|\.|\+|\~|\[/,selector_complex:/\s+|\>|\+|\~|\:|\.|\[/,selector_split:/\s+|\>|\+|\~/,sensitivity_types:/ci|cs|ms/,set_del:/^(set|del|delete)$/,sort_needle:/^.*:::/,sort_value:/:::.*$/,
space_hyphen:/\s|-/,string_boolean:/^(true|false)$/i,string_object:/string|object/i,string_true:/^true$/i,svg:/svg/,top_bottom:/top|bottom/i,true_undefined:/true|undefined/i,url:/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i,
webos:/webos/i,windows:/windows/i,xml:/xml/i},f={add:function(a,b){f.contains(a,b)||a.push(b);return a},binIndex:function(a,b){for(var c=0,d=a.length-1,e,k;c<=d;)if(e=Math.floor((c+d)/2),k=a[e],k<b)c=e+1;else if(k>b)d=e-1;else return e;return-1},cast:function(){return w||!r.ie||8<r.version?function(a,b){b=!0===b;var c=[];isNaN(a.length)?b?c=f.keys(a):g.iterate(a,function(a){c.push(a)}):c=Array.prototype.slice.call(a);return c}:function(a,b){b=!0===b;var c=[];if(isNaN(a.length))b?c=f.keys(a):g.iterate(a,
function(a){c.push(a)});else try{c=Array.prototype.slice.call(a)}catch(d){g.iterate(a,function(a,b){"length"!==b&&c.push(a)})}return c}},chunk:function(a,b){for(var c=[],d=u.round(a.length/b,"up"),e=0,k=-1;++k<d;)e=k*b,c.push(f.limit(a,e,b));return c},clear:function(a){return 0<a.length?f.remove(a,0,a.length):a},clone:function(a){return g.clone(a)},contains:function(a,b){return-1<f.index(a,b)},collect:function(a,b){var c=[];f.each(a,function(a){c.push(b(a))});return c},compact:function(a,b){var c=
[],c=a.filter(function(a){return!q.null_undefined.test(a)});return b?c.length<a.length?c:null:c},count:function(a,b){return a.filter(function(a){return a===b}).length},diff:function(a,b){var c=[];f.each(a,function(a){f.contains(b,a)||f.add(c,a)});f.each(b,function(b){f.contains(a,b)||f.add(c,b)});return c},each:function(a,b,c,d){var e=a.length,k;if(!0!==c)for(c=0;c<e&&!1!==b.call(a,a[c],c);c++);else d=d||10,k=0,d>e&&(d=e),g.repeat(function(){for(var c=0,f,c=0;c<d;c++)if(f=c+k,!1===b.call(a,a[f],f))return!1;
k+=d;if(k>=e)return!1},void 0,void 0,!1);return a},empty:function(a){return 0===a.length},equal:function(a,b){return H.encode(a)===H.encode(b)},fib:function(a){var b=[1,2],c=b[0],d=b[1],e;a=(a||100)-1;if(isNaN(a)||2>a)throw Error(t.error.invalidArguments);for(;--a;)e=c+d,c=d,d=e,b.push(e);return b},fill:function(a,b,c,d){var e="function"===typeof b,k=a.length;c=isNaN(c)?0:c;d=isNaN(d)?k-1:c+d;for(d>k-1&&(d=k-1);c<=d;)a[c]=e?b(a[c]):b,c++;return a},first:function(a){return a[0]},flat:function(a){var b=
[];return b=a.reduce(function(a,b){return a.concat(b)},b)},index:function(a,b){return a.indexOf(b)},indexed:function(a){var b=[];g.iterate(a,function(a){b.push(a)});return b},intersect:function(a,b){var c=a.length>b.length?a:b,d=c===a?b:a;return c.filter(function(a){return f.contains(d,a)})},keepIf:function(a,b){if("function"!==typeof b)throw Error(t.error.invalidArguments);var c=[],c=[],c=a.filter(b),c=f.diff(a,c);f.each(c,function(b){f.remove(a,f.index(a,b))});return a},keys:function(){return"function"===
typeof Object.keys?function(a){return Object.keys(a)}:function(a){var b=[];g.iterate(a,function(a,d){b.push(d)});return b}}(),last:function(a,b){var c=a.length-1;return b>=c+1?a:isNaN(b)||1===b?a[c]:f.limit(a,c- --b,c)},limit:function(a,b,c){var d=[],e=b-1;b+=c;c=a.length;if(0<c)for(;++e<b&&e<c;)d.push(a[e]);return d},max:function(a){return f.last(a.sort(f.sort))},mean:function(a){return 0<a.length?f.sum(a)/a.length:void 0},median:function(a){var b=a.length,c=u.round(b/2,"down");a=a.sort(f.sort);
return u.odd(b)?a[c]:(a[c-1]+a[c])/2},merge:function(a,b){f.each(b,function(b){f.add(a,b)});return a},min:function(a){return a.sort(f.sort)[0]},mingle:function(a,b){return a.map(function(a,d){return[a,b[d]]})},mode:function(a){var b={},c=0,d=0,e=[],k;f.each(a,function(a){isNaN(b[a])?b[a]=1:b[a]++});c=f.max(f.cast(b));g.iterate(b,function(a,b){a===c&&e.push(u.parse(b))});d=e.length;0<d&&(k=1===d?e[0]:e);return k},percents:function(a,b,c){var d=[],e=!1;b=b||0;void 0===c?c=f.sum(a):e=!0;f.each(a,function(a){d.push(u.parse((100*
(a/c)).toFixed(b)))});e||(a=f.sum(d),100>a?(a=u.parse(u.diff(a,100).toFixed(b)),a=f.last(d)+a,d[d.length-1]=a):100<a&&(a=u.parse(u.diff(a,100).toFixed(b)),a=u.parse((f.last(d)-a).toFixed(b)),d[d.length-1]=a));return d},range:function(a){return f.max(a)-f.min(a)},rassoc:function(a,b){var c;f.each(a,function(d,e){if(d[1]===b)return c=a[e],!1});return c},reject:function(a,b){return f.diff(a,a.filter(b))},replace:function(a,b){f.remove(a,0,a.length);f.each(b,function(b){a.push(b)});return a},remove:function(a,
b,c){if(isNaN(b)){if(b=a.index(b),-1===b)return a}else b=b||0;var d=a.length;c=a.slice((c||b)+1||d);a.length=0>b?d+b:b;a.push.apply(a,c);return a},removeIf:function(a,b){var c;if("function"!==typeof b)throw Error(t.error.invalidArguments);c=a.filter(b);f.each(c,function(b){f.remove(a,f.index(a,b))});return a},removeWhile:function(a,b){if("function"!==typeof b)throw Error(t.error.invalidArguments);var c=[];f.each(a,function(a){if(!1!==b(a))c.push(a);else return!1});f.each(c,function(b){f.remove(a,
f.index(a,b))});return a},rest:function(a,b){b=b||1;1>b&&(b=1);return f.limit(a,b,a.length)},rindex:function(a,b){var c=-1;f.each(a,function(a,e){a===b&&(c=e)});return c},rotate:function(a,b){var c=a.length;0===b?c=a:(0>b?b+=c:b--,c=f.limit(a,b,c),c=c.concat(f.limit(a,0,b)));return c},series:function(a,b,c){a=a||0;c=c||1;var d=[],e=-1;for(b=Math.max(0,Math.ceil(((b||a)-a)/c));++e<b;)d[e]=a,a+=c;return d},split:function(a,b){var c=[],d=a.length,e=Math.ceil(d/b),k=Math.floor(d/b),n=Math.ceil(d/e),g=
!1,p=0,ea=-1;for(u.diff(d,b*e)>e&&(n=d-k*b+k-1);++ea<b;)!g&&(n<b&&ea===n)&&(--e,g=!0),0<ea&&(p+=e),c.push(f.limit(a,p,e));return c},sort:function(a,b){var c=typeof a,d=typeof b,e,k;"number"===c&&"number"===d?c=a-b:(e=a.toString(),k=b.toString(),c=e<k?-1:e>k?1:c===d?0:"boolean"===c?-1:1);return c},sorted:function(a){return a.sort(f.sort)},sum:function(a){var b=0;0<a.length&&(b=a.reduce(function(a,b){return a+b}));return b},take:function(a,b){return f.limit(a,0,b)},total:function(a){return f.indexed(a).length},
toObject:function(a){for(var b={},c=a.length;c--;)b[c.toString()]=a[c];return b},unique:function(a){var b=[];f.each(a,function(a){f.add(b,a)});return b},zip:function(a,b){var c=[];b instanceof Array||(b="object"===typeof b?f.cast(b):[b]);f.each(b,function(a,b){a instanceof Array||(this[b]=[a])});f.each(a,function(a,e){c[e]=[a];f.each(b,function(a){c[e].push(a[e]||null)})});return c}},y={items:{},clean:function(){return g.iterate(y.items,function(a,b){y.expired(b)&&y.expire(b,!0)})},expire:function(a,
b){b=!0===b;return void 0!==y.items[a]?(delete y.items[a],b||m.fire(a,"beforeExpire, expire, afterExpire"),!0):!1},expired:function(a){a=y.items[a];return void 0!==a&&void 0!==a.expires&&a.expires<new Date},get:function(a,b){a=g.parse(a).href;return void 0===y.items[a]?!1:!1!==b&&y.expired(a)?(y.expire(a),!1):g.clone(y.items[a])},set:function(a,b,c){a=g.parse(a).href;void 0===y.items[a]&&(y.items[a]={},y.items[a].permission=0);"permission"===b?y.items[a].permission|=c:"!permission"===b?y.items[a].permission&=
~c:y.items[a][b]=c;return y.items[a]}},r={activex:function(){var a=!1;if("undefined"!==typeof ActiveXObject)try{new ActiveXObject("Microsoft.XMLHTTP"),a=!0}catch(b){}return a}(),android:!w&&q.android.test(E.userAgent),blackberry:!w&&q.blackberry.test(E.userAgent),chrome:!w&&q.chrome.test(E.userAgent),firefox:!w&&q.firefox.test(E.userAgent),ie:!w&&q.ie.test(E.userAgent),ios:!w&&q.ios.test(E.userAgent),linux:!w&&q.linux.test(E.userAgent),mobile:function(){return!w&&(/blackberry|iphone|webos/i.test(E.userAgent)||
q.android.test(E.userAgent)&&(720>this.client.size.height||720>this.client.size.width))},playbook:!w&&q.playbook.test(E.userAgent),opera:!w&&q.opera.test(E.userAgent),osx:!w&&q.osx.test(E.userAgent),safari:!w&&q.safari.test(E.userAgent.replace(/chrome.*/i,"")),tablet:function(){return!w&&(/ipad|playbook|webos/i.test(E.userAgent)||q.android.test(E.userAgent)&&(720<=this.client.size.width||720<=this.client.size.width))},webos:!w&&q.webos.test(E.userAgent),windows:!w&&q.windows.test(E.userAgent),version:function(){var a=
0;this.chrome?a=E.userAgent.replace(/(.*chrome\/|safari.*)/gi,""):this.firefox?a=E.userAgent.replace(/(.*firefox\/)/gi,""):this.ie?(a=u.parse(E.userAgent.replace(/(.*msie|;.*)/gi,""),10),x.documentMode<a&&(a=x.documentMode)):a=this.opera?E.userAgent.replace(/(.*version\/|\(.*)/gi,""):this.safari?E.userAgent.replace(/(.*version\/|safari.*)/gi,""):void 0!==E?E.appVersion:0;a=u.parse(l.trim(a));isNaN(a)&&(a=0);return a},allows:function(a,b){if(l.isEmpty(a)||l.isEmpty(b))throw Error(t.error.invalidArguments);
a=g.parse(a).href;b=b.toLowerCase();var c=!1,c=0;y.get(a,!1)?(q.del.test(b)?c=1:q.get_headers.test(b)?c=4:q.put_post.test(b)?c=2:q.patch.test(b)&&(c=8),c=Boolean(r.permissions(a,b).bit&c)):c=void 0;return c},bit:function(a){var b=0;f.each(a,function(a){a=a.toLowerCase();q.get_headers.test(a)?b|=4:q.put_post.test(a)?b|=2:q.patch.test(a)?b|=8:q.del.test(a)&&(b|=1)});return b},cors:function(a){return!w&&-1<a.indexOf("//")&&-1===a.indexOf("//"+O.host)},headers:function(a,b,c){a=l.trim(a.getAllResponseHeaders()).split("\n");
var d={},e={},k=null,n=new Date,g=r.cors(b);f.each(a,function(a){var b;b=a.replace(q.header_value_replace,"");a=a.replace(q.header_replace,"");a=l.unhyphenate(a,!0).replace(/\s+/g,"-");d[a]=b;null===k&&(!g&&q.allow.test(a)||g&&q.allow_cors.test(a))&&(k=b)});q.no.test(d["Cache-Control"])||(n=void 0!==d["Cache-Control"]&&q.number_present.test(d["Cache-Control"])?n.setSeconds(n.getSeconds()+u.parse(q.number_present.exec(d["Cache-Control"])[0],10)):void 0!==d.Expires?new Date(d.Expires):n.setSeconds(n.getSeconds()+
B.expires));e.expires=n;e.headers=d;e.permission=r.bit(null!==k?l.explode(k):[c]);"get"===c&&(y.set(b,"expires",e.expires),y.set(b,"headers",e.headers),y.set(b,"permission",e.permission));return e},parse:function(a,b){b=b||"";var c;(q.json_maybe.test(b)||l.isEmpty(b))&&q.json_wrap.test(a.responseText)&&Boolean(c=H.decode(a.responseText,!0))||(q.xml.test(b)?("text/xml"!==b&&a.overrideMimeType("text/xml"),c=a.responseXML):c="text/plain"===b&&q.is_xml.test(a.responseText)&&P.valid(a.responseText)?P.decode(a.responseText):
a.responseText);return c},permissions:function(a){a=(a=y.get(a,!1))?a.permission:0;var b={allows:[],bit:a,map:{partial:8,read:4,write:2,"delete":1,unknown:0}};a&1&&b.allows.push("DELETE");a&2&&(b.allows.push("POST"),b.allows.push("PUT"));a&4&&b.allows.push("GET");a&8&&b.allows.push("PATCH");return b},jsonp:function(a,b,c,d){var e=I.factory(),k="callback",f,s;void 0===da&&(void 0===D.abaaso&&g.define("abaaso.callback",{},D),da="abaaso");d instanceof Object&&void 0!==d.callback&&(k=d.callback);e.then(function(a){"function"===
typeof b&&b(a)},function(a){"function"===typeof c&&c(a);throw a;});do f=g.genId().slice(0,10);while(void 0!==D.abaaso.callback[f]);a=a.replace(k+"=?",k+"="+da+".callback."+f);D.abaaso.callback[f]=function(a){clearTimeout(g.timer[f]);delete g.timer[f];delete D.abaaso.callback[f];e.resolve(a);h.destroy(s)};s=h.create("script",{src:a,type:"text/javascript"},g.$("head")[0]);g.defer(function(){e.reject(void 0)},3E4,f);return e},request:function(a,b,c,d,e,k,f){f=f||3E4;var s,p,h,m,A,l,C,N,R;if(q.put_post.test(b)&&
void 0===e)throw Error(t.error.invalidArguments);a=g.parse(a).href;b=b.toLowerCase();k=k instanceof Object?k:null;s=r.cors(a);p=r.ie&&10>r.version&&s?new XDomainRequest:!r.ie||8<r.version||"patch"!==b?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e=(q.put_post.test(b)||q.patch.test(b))&&void 0!==e?e:null;h="get"===b?y.get(a):!1;m=b.capitalize();A=null;l="undefined"!==typeof Document;C="undefined"!==typeof ArrayBuffer;N="undefined"!==typeof Blob;R=I.factory();R.then(function(b){"function"===
typeof c&&c.call(a,b,p);p=null},function(b){"function"===typeof d&&d.call(a,b,p);p=null;throw b;});a.fire("before"+m);if(!s&&!q.get_headers.test(b)&&!1===r.allows(a,b))return p.status=405,R.reject(null),a.fire("failed"+m,null,p);if("get"===b&&Boolean(h))w&&(p.readyState=4,p.status=200,p._resheaders=h.headers),R.resolve(h.response),a.fire("afterGet",h.response,p);else{p["undefined"!==typeof p.onreadystatechange?"onreadystatechange":"onload"]=function(){r.response(p,a,b,R)};try{void 0!==p.timeout&&
(p.timeout=f)}catch(ja){}void 0!==p.ontimeout&&(p.ontimeout=function(b){a.fire("timeout"+m,b,p)});void 0!==p.onprogress&&(p.onprogress=function(b){a.fire("progress"+m,b,p)});void 0!==p.upload&&void 0!==p.upload.onprogress&&(p.upload.onprogress=function(b){a.fire("progressUpload"+m,b,p)});p.open(b.toUpperCase(),a,!0);null!==k&&k.hasOwnProperty("Content-Type")&&(A=k["Content-Type"]);s&&null===A&&(A="text/plain");null!==e&&(e.hasOwnProperty("xml")&&(e=e.xml),l&&e instanceof Document&&(e=P.decode(e)),
"string"===typeof e&&q.is_xml.test(e)&&(A="application/xml"),C&&e instanceof ArrayBuffer||(N&&e instanceof Blob||!(e instanceof Object))||(A="application/json",e=H.encode(e)),null===A&&(C&&e instanceof ArrayBuffer||N&&e instanceof Blob)&&(A="application/octet-stream"),null===A&&(A="application/x-www-form-urlencoded; charset=UTF-8"));"undefined"!==typeof p.setRequestHeader&&("object"===typeof h&&h.headers.hasOwnProperty("ETag")&&p.setRequestHeader("ETag",h.headers.ETag),null===k&&(k={}),null!==A&&
(k["Content-Type"]=A),k.hasOwnProperty("callback")&&delete k.callback,g.iterate(k,function(a,b){null!==a&&"withCredentials"!==b&&p.setRequestHeader(b,a)}));"boolean"===typeof p.withCredentials&&(null!==k&&"boolean"===typeof k.withCredentials)&&(p.withCredentials=k.withCredentials);null!==e?p.send(e):p.send()}return R},response:function(a,b,c,d){var e=l.capitalize(c.toLowerCase()),f=null,n=r.ie&&void 0===a.readyState,s=!0,p,h;p=function(a,c){d.reject(a);g.error(a,arguments,this,!0);b.fire("failed"+
e,r.parse(c),c)};if(n||2!==a.readyState)if(n||4!==a.readyState)n&&(h=r.parse(a,"text/plain"),y.set(b,"permission",r.bit(["get"])),y.set(b,"response",h),d.resolve(h),b.fire("afterGet",h,a));else{switch(a.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:n=r.headers(a,b,c);b.fire("headers",n.headers,a);if("head"===c)return d.resolve(n.headers),b.fire("afterHead",n.headers);if("options"===c)return d.resolve(n.headers),b.fire("afterOptions",n.headers);if("delete"!==c){w&&q.priv.test(n.headers["Cache-Control"])&&
(s=!1);if(q.http_body.test(a.status)&&(h=n.headers["Content-Type"]||"",h=r.parse(a,h),void 0===h))throw Error(t.error.serverError);"get"===c&&s?y.set(b,"response",n.response=g.clone(h)):y.expire(b,!0)}else"delete"===c&&y.expire(b,!0);null!==F.getHeader()&&(Boolean(f=n.headers[F.getHeader()])&&F.current!==f)&&F.setCurrent(F);switch(a.status){case 200:case 202:case 203:case 206:d.resolve(h);b.fire("after"+e,h,a);break;case 201:if(void 0!==n.headers.Location&&!l.isEmpty(n.headers.Location)||l.isUrl(h)){c=
l.trim(n.headers.Location||h);r.request(c,"GET",function(c){d.resolve(c);b.fire("after"+e,c,a)},function(b){p(b,a)});break}else p(Error(t.error.invalidArguments),a);break;case 204:d.resolve(null);b.fire("after"+e,null,a);break;case 205:d.resolve(null),b.fire("reset",null,a)}break;case 401:p(w?t.error.serverUnauthorized:Error(t.error.serverUnauthorized),a);break;case 403:y.set(b,"!permission",r.bit([c]));p(w?t.error.serverForbidden:Error(t.error.serverForbidden),a);break;case 405:y.set(b,"!permission",
r.bit([c]));p(w?t.error.serverInvalidMethod:Error(t.error.serverInvalidMethod),a);break;default:p(w?t.error.serverError:Error(t.error.serverError),a)}try{a.onreadystatechange=null}catch(m){}}else b.fire("received"+e,null,a)},size:function(){var a=w?{clientHeight:0,clientWidth:0}:void 0!==x.documentElement?x.documentElement:x.body;return{height:a.clientHeight,width:a.clientWidth}}},fa={expire:function(a,b,c,d,e){fa.set(a,"","-1s",b,c,d,e);return a},get:function(a,b){return g.coerce(fa.list(b)[a])},
list:function(a){var b={};void 0===a&&(a=w?"":x.cookie);l.isEmpty(a)||f.each(l.explode(a,";"),function(a){a=l.explode(a,"=");b[decodeURIComponent(a[0])]=g.coerce(decodeURIComponent(a[1]))});return b},set:function(a,b,c,d,e,f,n){b=(b||"")+";";c=c||"";d="string"===typeof d?" Domain="+d+";":"";e=!0===e?" secure":"";f="string"===typeof f?" Path="+f+";":"";var s="",p=null,h=null,m=["d","h","m","s"],A=RegExp(),L=m.length;if(!l.isEmpty(c)){for(;L--;)if(g.compile(A,m[L]),A.test(c)){h=m[L];p=u.parse(c,10);
break}if(isNaN(p))throw Error(t.error.invalidArguments);s=new Date;"d"===h?s.setDate(s.getDate()+p):"h"===h?s.setHours(s.getHours()+p):"m"===h?s.setMinutes(s.getMinutes()+p):"s"===h&&s.setSeconds(s.getSeconds()+p)}s instanceof Date&&(s=" Expires="+s.toUTCString()+";");w?(c=n.getHeader("Set-Cookie")||[],c.push((l.trim(a.toString())+"="+b+s+d+f+e).replace(/;$/,"")),n.setHeader("Set-Cookie",c)):x.cookie=l.trim(a.toString())+"="+b+s+d+f+e}},T={decorator:function(a,b,c){a=g.object(a);g.genId(a);"function"!==
typeof a.fire&&m.decorate(a);a.data=new W(a);c instanceof Object&&g.merge(a.data,c);null!==b&&"object"===typeof b&&a.data.batch("set",b);return a},methods:{batch:function(a,b,c,d){a=a.toString().toLowerCase();c=!0===c;d=d||1E3;if(!q.set_del.test(a)||c&&q.del.test(a)||"object"!==typeof b)throw Error(t.error.invalidArguments);var e=this,k=!0===this.events,n=0,s=b.length,p=!1,h=I.factory(),J,A,L,C,N;h.then(function(b){e.loaded=!0;q.del.test(a)&&e.reindex();e.autosave&&e.save();f.each(e.datalists,function(a){a.refresh(!0)});
k&&m.fire(e.parentNode,"afterDataBatch",b);return e.records},function(a){k&&m.fire(e.parentNode,"failedDataBatch",a);throw a;});J=function(a){h.resolve(a)};A=function(a){h.reject(a)};L=function(a,b){var c=g.clone(a),d=I.factory(),k={};"function"!==typeof c.batch?k=c:g.iterate(c,function(a,b){f.contains(e.collections,b)||(k[b]=a)});null!==e.key&&void 0!==k[e.key]&&(b=k[e.key],delete k[e.key],isNaN(b)||(b=b.toString()));d.then(function(){++n===s&&J(e.records)},function(a){p||(p=!0,A(a))});k instanceof
Array&&null!==e.uri?e.generate(b,void 0).then(function(a){d.resolve(a)},function(a){d.reject(a)}):e.set(b,k,!0).then(function(a){d.resolve(a)},function(a){d.reject(a)})};C=function(a){e.del(a,!1,!0).then(function(){++n===s&&J(e.records)},function(a){p||(p=!0,A(a))})};k&&m.fire(e.parentNode,"beforeDataBatch",b);c&&this.clear(c);0===b.length?J(e.records):"set"===a?f.each(b,function(a,b){var c;if("string"===typeof a&&f.contains(e.ignore,a)||f.contains(e.leafs,a))c=a,a={};"object"===typeof a?L(a,c||g.uuid()):
-1===a.indexOf("//")?(N=g.parse(e.uri),"/"!==a.charAt(0)?a=N.protocol+"//"+N.host+N.pathname+(q.endslash.test(N.pathname)?"":"/")+a:null!==e.uri&&q.root.test(a)&&(a=N.protocol+"//"+N.host+a),b=a.replace(q.not_endpoint,""),l.isEmpty(b)||r.request(a,"GET",function(a){L(null===e.source?a:g.walk(a,e.source),b)},A,g.merge({withCredentials:e.credentials},e.headers))):(b=a.replace(q.not_endpoint,""),l.isEmpty(b)||r.request(a,"GET",function(a){L(null===e.source?a:g.walk(a,e.source),b)},A,g.merge({withCredentials:e.credentials},
e.headers)))},!0,d):f.each(b.sort(f.sort).reverse(),function(a){C(a)},!0,d);return h},clear:function(a){var b=!0===this.events;!0===a?(this.collections=[],this.crawled=!1,this.keys={},this.loaded=!1,this.records=[],this.total=0,this.views={},f.each(this.datalists,function(a){a.refresh(!0,!0)})):(b&&m.fire(this.parentNode,"beforeDataClear"),f.each(this.datalists,function(a){a.teardown(!0)}),this.autosave=!1,this.callback=null,this.collections=[],this.crawled=!1,this.credentials=null,this.datalists=
[],this.depth=0,this.events=!0,this.expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.key=null,this.keys={},this.leafs=[],this.loaded=!1,this.maxDepth=0,this.pointer=null,this.records=[],this.retrieve=this.recursive=!1,this.source=null,this.total=0,this.views={},this.uri=null,b&&m.fire(this.parentNode,"afterDataClear"));return this},crawl:function(a){var b=this,c=!0===this.events,d=a instanceof Object?a:this.get(a),e=null===this.uri?"":this.uri,k=I.factory(),n=0,s=0,p,h,l;
if(void 0===d)throw Error(t.error.invalidArguments);this.crawled=!0;p=function(a,b){var c="";q.double_slash.test(a)?c=a:"/"===a.charAt(0)&&"/"!==b.charAt(0)?(c=g.parse(b),c=c.protocol+"//"+c.host+a):c=a;return c};h=function(){++n===s&&k.resolve(s)};l=function(a,b){var c={};f.contains(b.collections,a)||b.collections.push(a);c=T.decorator({id:d.key+"-"+a},null,{key:b.key,pointer:b.pointer,source:b.source,ignore:g.clone(b.ignore),leafs:g.clone(b.leafs),depth:b.depth+1,maxDepth:b.maxDepth});c.data.headers=
g.merge(c.data.headers,b.headers);!f.contains(b.leafs,a)&&(b.recursive&&b.retrieve&&(0===c.data.maxDepth||c.data.depth<c.data.maxDepth))&&(c.data.recursive=!0,c.data.retrieve=!0);return c};g.iterate(d.data,function(a,k){var n;if(!(f.contains(b.ignore,k)||f.contains(b.leafs,k)||b.depth>=b.maxDepth||!(a instanceof Array)&&"string"!==typeof a))if(s=f.cast(d.data).length,n=I.factory(),n.then(function(a){c&&m.fire(d.data[k],"afterDataRetrieve",a);h()},function(a){c&&m.fire(d.data[k],"failedDataRetrieve",
a);h()}),a instanceof Array&&0<a.length)d.data[k]=l(k,b),"string"===typeof a[0]&&f.each(a,function(b,c){a[c]=p(b,e)}),d.data[k].data.batch("set",a,!0,void 0).then(function(a){n.resolve(a)},function(a){n.reject(a)});else if("/"===a.charAt(0)||-1<a.indexOf("//"))d.data[k]=l(k,b),a=p(a,e),d.data[k].data.setUri(a).then(function(a){n.resolve(a)},function(a){n.reject(a)})});return k},del:function(a,b,c){if(void 0===a||!q.number_string.test(typeof a))throw Error(t.error.invalidArguments);b=!1!==b;c=!0===
c;var d=this,e=!0===this.events,k=I.factory(),n=I.factory(),s,p,h,l;k.then(function(a){var b=d.get(a.record);d.records.remove(d.keys[a.key]);delete d.keys[a.key];d.total--;d.views={};g.iterate(b.data,function(a){null!==a&&void 0!==a.data&&"function"===typeof a.data.teardown&&a.data.teardown()});a.reindex&&d.reindex();c||(d.autosave&&d.save(),f.each(d.datalists,function(a){a.del(b)}));e&&m.fire(d.parentNode,"afterDataDelete",b);n.resolve(b)},function(a){e&&m.fire(d.parentNode,"failedDataDelete",a);
n.reject(a)});if("string"===typeof a){if(s=a,a=this.keys[s],void 0===a)throw Error(t.error.invalidArguments);}else{s=this.records[a];if(void 0===s)throw Error(t.error.invalidArguments);s=s.key}p={key:s,record:a,reindex:b};c||(null!==this.callback||null===this.uri)||(h=this.uri+"/"+s,l=r.cors(h)||r.allows(h,"delete"));e&&m.fire(d.parentNode,"beforeDataDelete",p);c||null!==this.callback||null===this.uri?k.resolve(p):q.true_undefined.test(l)?r.request(h,"DELETE",function(){k.resolve(p)},function(a){k.reject(a)},
g.merge({withCredentials:this.credentials},this.headers)):k.reject(p);return n},dump:function(a,b){a=a||this.records;var c=this;return a.map(b instanceof Array&&0<b.length?function(a){var e={};f.each(b,function(b){e[b]=b===c.key?a.key:f.contains(c.collections,b)?a.data[b].data.uri:g.clone(a.data[b])});return e}:function(a){var b={};b[c.key]=a.key;g.iterate(a.data,function(a,d){b[d]=f.contains(c.collections,d)?a.data.uri:g.clone(a)});return b})},find:function(a,b,c){if(void 0===a)throw Error(t.error.invalidArguments);
var d=[],e=[],k=RegExp(),n="function"===typeof a;if(0===this.total)return d;n||(a="string"===typeof a?l.explode(a):[a],void 0===c||l.isEmpty(c)?c="gi":null===c&&(c=""));b="string"===typeof b?l.explode(b):null;null===b?f.each(this.records,function(b){n?!0===a(b)&&(e.push(b.key),d.push(b)):g.iterate(b.data,function(n){if(f.contains(e,b.key))return!1;null!==n&&"object"!==typeof n.data&&f.each(a,function(a){g.compile(k,a,c);if(k.test(n))return e.push(b.key),d.push(b),!1})})}):f.each(this.records,function(s){f.each(b,
function(b){if(f.contains(e,s.key))return!1;if(void 0!==s.data[b]&&"object"!==typeof s.data[b].data)if(!n)f.each(a,function(a){g.compile(k,a,c);if(k.test(s.data[b]))return e.push(s.key),d.push(s),!1});else if(!0===a(s.data[b]))return e.push(s.key),d.push(s),!1})});return d},form:function(a,b,c){c=!1!==c;var d=null===a,e=this,k,n,s,p;d?a=this.get(0):a instanceof Object||(a=this.get(a));if(void 0===a)throw Error(t.error.invalidArguments);if(null!==this.uri&&!r.cors(this.uri)&&!r.allows(this.uri,"post"))throw Error(t.error.serverInvalidMethod);
s=a.key;p=a.data;void 0!==b&&(b=g.object(b));null!==this.uri?(a=this.uri.replace(q.not_endpoint,"").replace(/\?.*/,""),l.isDomain(a)&&(a=a.replace(/\..*/g,""))):a="record";k=function(a){var b=g.target(a).parentNode,d=g.$("#"+b.id+" input"),k=d[0].name.match(/(.*)\[/)[1],n=!0,p={};g.stop(a);c&&(n=h.validate(b));n&&(f.each(d,function(a){void 0!==a.type&&q.input_button.test(a.type)||g.define(a.name.replace("[",".").replace("]",""),a.value,p)}),e.set(s,p[k]).then(function(){h.destroy(b)},function(){h.destroy(b)}))};
n=function(a,b,c){var e,k;g.iterate(a,function(a,g){a instanceof Array?(e=0,f.each(a,function(a){n(a,b,c+"["+g+"]["+e++ +"]")})):a instanceof Object?n(a,b,c+"["+g+"]"):(k=(c+"["+g+"]").replace(/\[|\]/g,""),b.create("label",{"for":k,innerHTML:l.capitalize(g)}),b.create("input",{id:k,name:c+"["+g+"]",type:"text",value:d?"":a}))})};b=h.create("form",{style:"display:none;"},b);n(p,b,a);m.add(h.create("input",{type:"button",value:t.common.submit},b),"click",function(a){k(a)});h.create("input",{type:"reset",
value:t.common.reset},b);h.css(b,"display","inherit");return b},generate:function(a,b){var c=this,d=I.factory(),e=null,k,n,g;g={depth:this.depth+1,headers:this.headers,ignore:f.clone(this.ignore),leafs:f.clone(this.leafs),key:this.key,maxDepth:this.maxDepth,pointer:this.pointer,recursive:this.recursive,retrieve:this.retrieve,source:this.source};k=function(){"object"===typeof b&&(e=b);if(0===g.maxDepth||g.depth<=g.maxDepth)c.records[n]=T.decorator({id:a},e,g),null===e&&(null===c.uri||(void 0!==b||
f.contains(c.leafs,a))||(b=c.uri+"/"+a),void 0!==b?c.records[n].data.setUri(b).then(function(a){d.resolve(a)},function(a){d.reject(a)}):d.resolve(c.records[n].data.records))};void 0!==this.keys[a]?(n=this.keys[a],"function"===typeof this.records[n].data.teardown&&this.records[n].data.teardown(),k()):this.set(a,{},!0).then(function(a){n=c.keys[a.key];c.collections.add(a.key);k()});return d},get:function(a,b){var c=this.records,d=typeof a,e=this,k;"undefined"===d||0===a.toString().length?k=c:"string"===
d&&-1<a.indexOf(",")?(k=[],f.each(l.explode(a),function(a){isNaN(a)||(a=u.parse(a,10));k.push(e.get(a))})):"string"===d&&void 0!==this.keys[a]?k=c[this.keys[a]]:"number"===d&&void 0===b?k=c[u.parse(a,10)]:"number"===d&&"number"===typeof b&&(k=c.limit(u.parse(a,10),u.parse(b,10)));return k},join:function(a,b,c){c=c||"inner";var d=this,e=[],k=b===this.key,n=f.merge(f.cast(this.records[0].data,!0),f.cast(a.data.records[0].data,!0)),s;"inner"===c?s=function(c){var d={};d[b]=k?c.key:c.data[b];d=a.data.select(d);
if(2<d.length)throw Error(t.error.databaseMoreThanOne);1===d.length&&e.push(g.merge(g.clone(c.data),g.clone(d[0].data)))}:"left"===c?s=function(c){var d={},s=g.clone(c.data);d[b]=k?c.key:c.data[b];c=a.data.select(d);if(2<c.length)throw Error(t.error.databaseMoreThanOne);1===c.length?e.push(g.merge(g.clone(s),g.clone(c[0].data))):(f.each(n,function(a){void 0===s[a]&&(s[a]=null)}),e.push(s))}:"right"===c&&(s=function(a){var c={},s=g.clone(a.data);c[b]=k?a.key:a.data[b];a=d.select(c);if(2<a.length)throw Error(t.error.databaseMoreThanOne);
1===a.length?e.push(g.merge(g.clone(s),g.clone(a[0].data))):(f.each(n,function(a){void 0===s[a]&&(s[a]=null)}),e.push(s))});f.each("right"===c?a.data.records:this.records,s);return e},only:function(a){return a===this.key?this.records.map(function(a){return a.key}):this.records.map(function(b){return b.data[a]})},purge:function(a){return this.storage(a||this,"remove")},reindex:function(){var a=this.total,b=-1;this.views={};if(0<a)for(;++b<a;)this.records[b].index=b,this.keys[this.records[b].key]=b;
return this},restore:function(a){return this.storage(a||this,"get")},save:function(a){return this.storage(a||this,"set")},select:function(a){if(!(a instanceof Object))throw Error(t.error.invalidArguments);return this.records.filter(function(b){var c=!0;g.iterate(a,function(a,e){var f=typeof a;if("function"!==f&&b.data[e]!==a||"function"===f&&!a(b.data[e],b))return c=!1});return c})},set:function(a,b,c){c=!0===c;var d=this,e=I.factory(),k=I.factory(),n=!1,s,h,l,J,A,L,C;if(!(b instanceof Object))throw Error(t.error.invalidArguments);
C=function(a,b){k[a?"resolve":"reject"](b)};e.then(function(a){var b=null,e=a.key,k=a.record,n=a.result,s=I.factory(),h,b=g.clone(a.data);s.then(function(a){d.retrieve&&d.crawl(a);c||(d.autosave&&d.save(e),f.each(d.datalists,function(a){a.refresh()}));l&&m.fire(d.parentNode,"afterDataSet",a);C(!0,a)},function(a){l&&m.fire(d.parentNode,"failedDataSet",a);C(!1,a)});d.views={};void 0!==e&&(k=d.get(e));if(void 0===k)if(a=d.total++,void 0===e&&(void 0===n&&(d.total--,s.reject(t.error.expectedObject)),
null!==d.source&&(n=g.walk(n,d.source)),null===d.key?e=g.uuid():(e=n[d.key],delete n[d.key]),"string"!==typeof e&&(e=e.toString()),b=n),d.keys[e]=a,d.records[a]={key:e,data:{},index:a},h=d.records[a],null===d.pointer||void 0===b[d.pointer])h.data=b,null!==d.key&&h.data.hasOwnProperty(d.key)&&delete h.data[d.key],s.resolve(h);else{b=b[d.pointer];if(void 0===b||null===b)delete d.records[a],delete d.keys[e],s.reject(t.error.expectedObject);h.data={};r.request(b,"GET",function(a){null!==d.source&&(a=
g.walk(a,d.source));void 0!==a[d.key]&&delete a[d.key];h.data=a;s.resolve(h)},function(a){s.reject(a)},d.headers)}else h=d.records[d.keys[k.key]],h.data=b,s.resolve(h);return h},function(a){l&&m.fire(d.parentNode,"failedDataSet",a);throw a;});a instanceof Object&&(c=b,b=a,a=null);s=g.clone(b);null===a&&null===this.uri?null===this.key||void 0===s[this.key]?a=g.uuid():(a=s[this.key],delete s[this.key]):null===a&&(a=void 0);if(s instanceof Array)return this.generate(a).then(function(){d.get(a).data.batch("set",
s).then(function(a){e.resolve(a)},function(a){e.reject(a)})});b=void 0===a?void 0:this.get(a);h=void 0===a?"post":"put";l=!0===this.events;J={data:{},key:a,record:void 0};A=this.uri;c||(null!==this.callback||null===A)||(void 0!==b&&A.replace(q.not_endpoint,"")!==b.key&&(A+="/"+b.key),"put"===h&&(r.allows(A,"patch")&&(!r.ie||8<r.version||r.activex))&&(h="patch",L=n=!0),void 0===L&&(L=r.cors(A)||r.allows(A,h)));void 0!==b?(J.record=this.records[this.keys[b.key]],g.iterate(J.record.data,function(a,b){f.contains(d.ignore,
b)||(J.data[b]=a)}),g.merge(J.data,s),n||(s=J.data)):J.data=s;l&&m.fire(d.parentNode,"beforeDataSet",{key:a,data:s});c||null!==this.callback||null===this.uri?e.resolve(J):q.true_undefined.test(L)?r.request(A,h.toUpperCase(),function(a){J.result=a;e.resolve(J)},function(a){e.reject(a)},s,g.merge({withCredentials:this.credentials},this.headers)):e.reject(J);return k},setExpires:function(a){if(null!==a&&null===this.uri||null!==a&&(isNaN(a)||1E3>a))throw Error(t.error.invalidArguments);if(this.expires!==
a){this.expires=a;var b=this.parentNode.id+"DataExpire",c=this;g.clearTimers(b);null!==a&&g.repeat(function(){if(null===c.uri)return c.setExpires(null),!1;y.expire(c.uri)||m.fire(c.uri,"beforeExpire, expire, afterExpire")},a,b,!1)}},setUri:function(a){var b=I.factory();if(null!==a&&l.isEmpty(a))throw Error(t.error.invalidArguments);a=g.parse(a).href;this.uri===a?a=this.uri:(null!==this.uri&&m.remove(this.uri),a=this.uri=a,null!==a&&(m.add(a,"expire",function(){this.sync(!0)},"dataSync",this),y.expire(a,
!0),this.sync(!0).then(function(a){b.resolve(a)},function(a){b.reject(a)})));return b},sort:function(a,b,c,d){if(void 0===a||l.isEmpty(a))throw Error(t.error.invalidArguments);q.sensitivity_types.test(c)||(c="ci");a=a.replace(q.asc,"");b=!0===b||d instanceof Object;a=l.explode(a);var e=a.join(" ").toCamelCase()+c.toUpperCase(),k=this.key,n=[],s,h,m,r;if(!b&&this.views[e]instanceof Array)return this.views[e];if(0===this.total)return[];h=function(a,b){var c=g.clone(a),d=a[0],e={},k=[];f.remove(c,0);
e=s(d,b,q.desc.test(d));f.each(e.order,function(a){2>e.registry[a].length||0<c.length&&(e.registry[a]=h(c,e.registry[a]))});f.each(e.order,function(a){k=k.concat(e.registry[a])});return k};s=function(a,b,d){var e=a.replace(q.desc,""),n=k===e,g=[],h={};f.each(b,function(a){var b=n?a.key:a.data[e],b=null===b?"null":b.toString();"ci"===c?b=l.toCamelCase(b):"cs"===c?b=l.trim(b):"ms"===c&&(b=l.trim(b).slice(0,1).toLowerCase());h[b]instanceof Array||(h[b]=[],g.push(b));h[b].push(a)});g.sort(r);d&&g.reverse();
f.each(g,function(b){1!==h[b].length&&(h[b]=m(h[b],a,e,d,n))});return{order:g,registry:h}};m=function(a,b,c,d,e){var k=[];b=[];f.each(a,function(a,b){var d=e?a.key:a.data[c]||"!",d=l.trim(d.toString())+":::"+b;k.push(d)});1<k.length&&(k.sort(r),d&&k.reverse(),b=k.map(function(b){return a[b.replace(q.sort_needle,"")]}));return b};r=function(a,b){a=a.replace(q.sort_value,"");b=b.replace(q.sort_value,"");return f.sort(u.parse(a)||a,u.parse(b)||b)};n=h(a,void 0===d?this.records:this.select(d));return this.views[e]=
n},storage:function(a,b,c){var d=this,e=!1,k=!l.isEmpty(this.mongodb);c="session"===c&&"undefined"!==typeof sessionStorage;var n=I.factory(),h,p;if(!q.number_string_object.test(typeof a)||!q.get_remove_set.test(b))throw Error(t.error.invalidArguments);e=q.number_string.test(typeof a)||a.hasOwnProperty("key")&&!a.hasOwnProperty("parentNode");!e||a instanceof Object||(a=this.get(a));p=e?a.key:a.parentNode.id;if("get"===b)if(k)mongodb.connect(this.mongodb,function(b,c){b?(n.reject(b),c.close()):c.createCollection(d.parentNode.id,
function(b,k){b?(n.reject(b),c.close()):e?k.find({_id:a.key}).limit(1).toArray(function(a,b){a?n.reject(a):(delete b[0]._id,d.set(p,b[0],!0).then(function(a){n.resolve(a)},function(a){n.reject(a)}));c.close()}):k.find({}).toArray(function(a,b){var e=-1,k=b.length;a?n.reject(a):(0<k&&(d.records=b.map(function(a){var b={key:a._id,index:++e,data:{}};d.keys[b.key]=b.index;b.data=a;delete b.data._id;return b}),d.total=k),n.resolve(d.records));c.close()})})});else{b=c?sessionStorage.getItem(p):localStorage.getItem(p);
if(null===b)throw Error(t.error.invalidArguments);b=H.decode(b);e?d.set(p,b,!0).then(function(a){n.resolve(a)},function(a){n.reject(a)}):(g.merge(d,b),n.resolve(d))}else"remove"===b?k?mongodb.connect(this.mongodb,function(b,c){b?(n.reject(b),c.close()):c.createCollection(d.parentNode.id,function(b,d){d.remove(e?{_id:a.key}:{},{safe:!0},function(a,b){a?n.reject(a):n.resolve(b);c.close()})})}):(c?sessionStorage.removeItem(p):localStorage.removeItem(p),n.resolve(this)):"set"===b&&(k?mongodb.connect(this.mongodb,
function(b,c){b?(n.reject(b),c.close()):c.createCollection(d.parentNode.id,function(b,k){b?(n.reject(b),c.close()):e?k.update({_id:a.key},{$set:a.data},{w:1,safe:!0,upsert:!0},function(a,b){a?n.reject(a):n.resolve(b);c.close()}):(h=[],f.each(d.records,function(a){var b={},c=I.factory();h.push(c);g.iterate(a.data,function(a,c){f.contains(d.collections,c)||(b[c]=a)});k.update({_id:a.key},{$set:b},{w:1,safe:!0,upsert:!0},function(a,b){a?c.reject(a):c.resolve(b)})}),g.when(h).then(function(a){n.resolve(a);
c.close()},function(a){n.reject(a);c.close()}))})}):(b=H.encode(e?a.data:{total:this.total,keys:this.keys,records:this.records}),c?sessionStorage.setItem(p,b):localStorage.setItem(p,b),n.resolve(this)));return n},sync:function(a){if(null===this.uri||l.isEmpty(this.uri))throw Error(t.error.invalidArguments);a=!0===a;var b=this,c=!0===this.events,d=I.factory(),e,k;d.then(function(d){a&&b.reindex();c&&m.fire(b.parentNode,"afterDataSync",d)},function(a){c&&m.fire(b.parentNode,"failedDataSync",a);throw a;
});e=function(a){var c;if("object"!==typeof a)throw Error(t.error.expectedObject);null!==b.source&&(a=g.walk(a,b.source));a instanceof Array?c=a:g.iterate(a,function(a){if(a instanceof Array)return c=a,!1});void 0===c&&(c=[a]);b.batch("set",c,!0,void 0).then(function(a){d.resolve(a)},function(a){d.reject(a)})};k=function(a){d.reject(a)};c&&m.fire(b.parentNode,"beforeDataSync");null!==this.callback?r.jsonp(this.uri,e,k,{callback:this.callback}):r.request(this.uri,"GET",e,k,null,g.merge({withCredentials:this.credentials},
this.headers));return d},teardown:function(){var a=this.uri,b;null!==a&&(y.expire(a,!0),m.remove(a),b=this.parentNode.id+"DataExpire",g.clearTimers(b),f.each(this.datalists,function(a){a.teardown()}),f.each(this.records,function(b){var d=a+"/"+b.key;y.expire(d,!0);m.remove(d);g.iterate(b.data,function(a){null!==a&&(a.hasOwnProperty("data")&&"function"===typeof a.data.teardown)&&(m.remove(a.id),a.data.teardown())})}));this.clear(!0);m.fire(this.parentNode,"afterDataTeardown");return this},unique:function(a){var b=
[];f.each(this.records,function(c){f.add(b,c.data[a])});return b},update:function(a,b){var c=this.get(a),d=I.factory();if(void 0===c)throw Error(t.error.invalidArguments);c=g.merge(g.clone(c.data),b);this.set(a,c).then(function(a){d.resolve(a)},function(a){d.reject(a)});return d}}};W.prototype=T.methods;W.prototype.constructor=W;var S={factory:function(a,b,c,d){var e=[b];if(!(a instanceof Element&&"object"===typeof b&&q.string_object.test(typeof c)))throw Error(t.error.invalidArguments);a=h.create("ul",
{"class":"list",id:b.parentNode.id+"-datalist"},a);c=new X(a,e[0],c);d instanceof Object&&g.merge(c,d);c.store.datalists.push(c);(null===c.store.uri||c.store.loaded)&&c.refresh(!0);return c},methods:{del:function(a){"number"===typeof this.pageIndex&&"number"===typeof this.pageSize?this.refresh():(m.fire(this.element,"beforeDataListRefresh"),f.each(this.element.find("> li[data-key='"+a.key+"']"),function(a){h.destroy(a)}),m.fire(this.element,"afterDataListRefresh"));return this},dump:function(){return this.store.dump(this.records)},
page:function(a){if(isNaN(a))throw Error(t.error.invalidArguments);this.pageIndex=a;this.refresh();return this},pages:function(){var a=this.element,b=this.pageIndex,c=this.pagination,d=this.pageRange,e=u.round(u.half(d),"down"),k=b-e,n=b+e,s=this,p=S.pages.call(this);if(!q.top_bottom.test(c))throw Error(t.error.invalidArguments);f.each(g.$("#"+a.id+"-pages-top, #"+a.id+"-pages-bottom"),function(a){void 0!==a&&h.destroy(a)});if(0===this.total||1===p)return this;1>k&&(e=u.diff(k,1),k+=e,n+=e);n>p&&
(n=p,k=n-d+1,1>k&&(k=1));f.each(l.explode(c),function(c){var d=!1,d=1<b,e=b+1<=p,f=b>=p,l;c=h.create("ul",{"class":"list pages hidden "+c,id:a.id+"-pages-"+c},a,"bottom"===c?"after":"before");h.create(d?"a":"span",{"class":"first page","data-page":1,innerHTML:"&lt;&lt;"},h.create("li",{},c));h.create(d?"a":"span",{"class":"prev page","data-page":b-1,innerHTML:"&lt;"},h.create("li",{},c));for(l=k;l<=n;l++)d=l===b,h.create(d?"span":"a",{"class":d?"current page":"page","data-page":l,innerHTML:l},h.create("li",
{},c));h.create(e?"a":"span",{"class":"next page","data-page":e?b+1:null,innerHTML:"&gt;"},h.create("li",{},c));h.create(f?"span":"a",{"class":"last page","data-page":f?null:p,innerHTML:"&gt;&gt;"},h.create("li",{},c));h.klass(c,"hidden",!1);m.add(c,"click",function(a){var b=g.target(a);g.stop(a);"A"===b.nodeName&&(s.page(h.data(b,"page")),window.scrollTo(0,0))},"pagination")});return this},refresh:function(a,b){a=!1!==a;b=!0===b;var c=this.element,d="object"===typeof this.template,e=[],k=[],n=this,
s="function"===typeof this.callback,p=RegExp(),r=[],e=[],t;m.fire(c,"beforeDataListRefresh");t=d?function(a){var b=H.encode(n.template),c=f.unique(b.match(/\{\{[\w\.\-]+\}\}/g)),b=b.replace("{{"+n.store.key+"}}",a.key);f.each(c,function(c){var d=c.replace(/\{\{|\}\}/g,""),d=g.walk(a.data,d);p.compile(c,"g");b=b.replace(p,H.encode(d).replace(/(^")|("$)/g,""))});b=H.decode(b.replace(/\{\{.*\}\}/g,n.placeholder));return{li:b}}:function(a){var b=n.template,c=f.unique(b.match(/\{\{[\w\.\-]+\}\}/g)),b=
b.replace("{{"+n.store.key+"}}",a.key);f.each(c,function(c){var d=c.replace(/\{\{|\}\}/g,""),d=g.walk(a.data,d);p.compile(c,"g");b=b.replace(p,d)});b=b.replace(/\{\{.*\}\}/g,n.placeholder);return{li:b}};e=null===this.where?l.isEmpty(this.order)?this.store.get():this.store.sort(this.order,b,this.sensitivity):l.isEmpty(this.order)?this.store.select(this.where):this.store.sort(this.order,b,this.sensitivity,this.where);f.each(e,function(a){null!==n.filter&&n.filter instanceof Object?g.iterate(n.filter,
function(b,c){var d,e;f.contains(r,a.key)||(b=l.explode(b),d=RegExp(),e=c===n.store.key,f.each(b,function(b){g.compile(d,b,"i");if(e&&d.test(a.key)||void 0!==a.data[c]&&d.test(a.data[c]))return r.push(a.key),k.push({key:a.key,template:t(a)}),!1}))}):k.push({key:a.key,template:t(a)})});this.records=k;this.total=k.length;if("number"===typeof this.pageIndex&&"number"===typeof this.pageSize){d=S.pages.call(this);if(0<d&&this.pageIndex>d)return this.page(d);0<this.total&&(e=S.range.call(this),k=k.limit(e[0],
e[1]))}a?(h.clear(c),0===this.total?h.create("li",{innerHTML:this.emptyMsg,"class":"empty"},c):f.each(k,function(a){var b=g.tpl(a.template,c);h.data(b,"key",a.key);s&&n.callback(b)})):(f.each(h.find(c,"> li"),function(a){h.addClass(a,"hidden")}),f.each(k,function(a){f.each(h.find(c,"> li[data-key='"+a.key+"']"),function(a){h.removeClass(a,"hidden")})}));q.top_bottom.test(this.pagination)&&"number"===typeof this.pageIndex&&"number"===typeof this.pageSize?this.pages():f.each(g.$("#"+c.id+"-pages-top, #"+
c.id+"-pages-bottom"),function(a){h.destroy(a)});m.fire(c,"afterDataListRefresh");return this},sort:function(a,b,c){if("string"!==typeof a)throw Error(t.error.invalidArguments);this.element.fire("beforeDataListSort");this.order=a;this.sensitivity=b||"ci";this.refresh(!0,c);this.element.fire("afterDataListSort");return this},teardown:function(a){a=!0===a;var b=this,c=this.element.id;m.remove(c);f.each(g.$("#"+c+"-pages-top, #"+c+"-pages-bottom"),function(a){m.remove(a)});f.each(this.store.datalists,
function(a,c){if(a.id===b.id)return this.remove(c),!1});a&&(h.destroy(this.element),this.element=null);return this}},pages:function(){if(isNaN(this.pageSize))throw Error(t.error.invalidArguments);return u.round(this.total/this.pageSize,"up")},range:function(){return[this.pageIndex*this.pageSize-this.pageSize,this.pageSize]}};X.prototype=S.methods;X.prototype.constructor=X;var I={factory:function(){return new Y},methods:{always:function(a){if("function"!==typeof a)throw Error(t.error.invalidArguments);
if(this.promise.resolved())throw Error(t.error.promiseResolved.replace("{{outcome}}",this.promise.outcome));this.onAlways.push(a);return this},done:function(a){if("function"!==typeof a)throw Error(t.error.invalidArguments);if(this.promise.resolved())throw Error(t.error.promiseResolved.replace("{{outcome}}",this.promise.outcome));this.onDone.push(a);return this},fail:function(a){if("function"!==typeof a)throw Error(t.error.invalidArguments);if(this.promise.resolved())throw Error(t.error.promiseResolved.replace("{{outcome}}",
this.promise.outcome));this.onFail.push(a);return this},isRejected:function(){return this.promise.state===z.state.broken},isResolved:function(){return this.promise.state===z.state.resolved},reject:function(a){this.promise.reject.call(this.promise,a);return this},resolve:function(a){this.promise.resolve.call(this.promise,a);return this},state:function(){return this.promise.state},then:function(a,b){return this.promise.then(a,b)}}};Y.prototype=I.methods;Y.prototype.constructor=Y;var h={attr:function(a,
b,c){if(q.svg.test(a.namespaceURI))void 0===c?(c=a.getAttributeNS(a.namespaceURI,b),null===c||l.isEmpty(c)||g.coerce(c)):a.setAttributeNS(a.namespaceURI,b,c);else{"string"===typeof c&&(c=l.trim(c));if(q.checked_disabled.test(b)&&void 0===c)return g.coerce(a[b]);if(q.checked_disabled.test(b)&&void 0!==c)a[b]=c;else{if("SELECT"===a.nodeName&&"selected"===b&&void 0===c)return g.$("#"+a.id+' option[selected="selected"]')[0]||g.$("#"+a.id+" option")[0];if("SELECT"===a.nodeName&&"selected"===b&&void 0!==
c)b=g.$("#"+a.id+' option[selected="selected"]')[0],void 0!==b&&(b.selected=!1,b.removeAttribute("selected")),b=g.$("#"+a.id+' option[value="'+c+'"]')[0],b.selected=!0,b.setAttribute("selected","selected");else{if(void 0===c)return c=a.getAttribute(b),c=null===c||l.isEmpty(c)?void 0:g.coerce(c);a.setAttribute(b,c)}}}return a},clear:function(a){"function"===typeof a.reset?a.reset():void 0!==a.value?h.update(a,{innerHTML:"",value:""}):h.update(a,{innerHTML:""});return a},create:function(a,b,c,d){var e=
!1,k;if(void 0===a||l.isEmpty(a))throw Error(t.error.invalidArguments);if(void 0!==c){c=g.object(c);if(void 0===c)throw Error(t.error.invalidArguments);e=void 0!==c.namespaceURI&&q.svg.test(c.namespaceURI)}else c=x.body;b instanceof Object&&void 0!==b.id&&void 0===g.$("#"+b.id)?(k=b.id,delete b.id):e||(k=g.genId(void 0,!0));a=e||q.svg.test(a)?x.createElementNS("http://www.w3.org/2000/svg",a):x.createElement(a);void 0!==k&&(a.id=k);b instanceof Object&&h.update(a,b);void 0===d||"last"===d?c.appendChild(a):
"first"===d?h.prependChild(c,a):"after"===d?(d={},d.after=c,c=c.parentNode,c.insertBefore(a,d.after.nextSibling)):void 0!==d.after?c.insertBefore(a,d.after.nextSibling):"before"===d?(d={},d.before=c,c=c.parentNode,c.insertBefore(a,d.before)):void 0!==d.before?c.insertBefore(a,d.before):c.appendChild(a);return a},css:function(a,b,c){a=g.object(a);b=l.toCamelCase(b);void 0!==c?a.style[b]=c:a=a.style[b];return a},data:function(a,b,c){var d="object"===typeof a.dataset;d&&(b=l.toCamelCase(b));void 0!==
c?d?a.dataset[b]=c:h.attr(a,"data-"+b,c):a=g.coerce(d?a.dataset[b]:h.attr(a,"data-"+b));return a},destroy:function(a){m.remove(a);null!==a.parentNode&&a.parentNode.removeChild(a)},disable:function(a){"boolean"!==typeof a.disabled||a.disabled||(a.disabled=!0);return a},dispatch:function(){return"function"===typeof CustomEvent?function(a,b,c,d,e){var k=new CustomEvent(b);k.initCustomEvent(b,!1!==d,!1!==e,c||{});a.dispatchEvent(k);return a}:void 0!==x&&"function"===typeof x.createEvent?function(a,b,
c,d,e){var k=x.createEvent("HTMLEvents");k.initEvent(b,!1!==d,!1!==e);k.detail=c||{};a.dispatchEvent(k);return a}:void 0!==x&&"object"===typeof x.createEventObject?function(a,b,c,d){var e=x.createEventObject();e.cancelBubble=!1!==d;e.detail=c||{};a.fireEvent("on"+b,e)}:function(){throw Error(t.error.notSupported);}}(),enable:function(a){"boolean"===typeof a.disabled&&a.disabled&&(a.disabled=!1);return a},find:function(a,b){var c=[];g.genId(a,!0);f.each(l.explode(b),function(b){c=c.concat(g.$("#"+
a.id+" "+b))});return c},has:function(a,b){var c=h.find(a,b);return!isNaN(c.length)&&0<c.length},hasClass:function(a,b){return a.classList.contains(b)},hide:function(a){"boolean"===typeof a.hidden?a.hidden=!0:(a["data-display"]=a.style.display,a.style.display="none");return a},hidden:function(a){return"none"===a.style.display||"boolean"===typeof a.hidden&&a.hidden},html:function(a,b){return void 0===b?l.trim(a.innerHTML):h.update(a,{innerHTML:l.trim(b)})},is:function(a,b){return q.selector_is.test(b)?
(g.id(a),1===h.find(a.parentNode,a.nodeName.toLowerCase()+b).filter(function(b){return b.id===a.id}).length):RegExp(b).test(a.nodeName)},isAlphaNum:function(a){return"FORM"===a.nodeName?!1:K.test({alphanum:a.value||h.text(a)}).pass},isBoolean:function(a){return"FORM"===a.nodeName?!1:K.test({"boolean":a.value||h.text(a)}).pass},isChecked:function(a){return"INPUT"!==a.nodeName?!1:h.attr(a,"checked")},isDate:function(a){return"FORM"===a.nodeName?!1:l.isDate(a.value||h.text(a))},isDisabled:function(a){return"INPUT"!==
a.nodeName?!1:h.attr(a,"disabled")},isDomain:function(a){return"FORM"===a.nodeName?!1:l.isDomain(a.value||h.text(a))},isEmail:function(a){return"FORM"===a.nodeName?!1:l.isEmail(a.value||h.text(a))},isEmpty:function(a){return"FORM"===a.nodeName?!1:l.isEmpty(a.value||h.text(a))},isIP:function(a){return"FORM"===a.nodeName?!1:l.isIP(a.value||h.text(a))},isInt:function(a){return"FORM"===a.nodeName?!1:l.isInt(a.value||h.text(a))},isNumber:function(a){return"FORM"===a.nodeName?!1:l.isNumber(a.value||h.text(a))},
isPhone:function(a){return"FORM"===a.nodeName?!1:l.isPhone(a.value||h.text(a))},isUrl:function(a){return"FORM"===a.nodeName?!1:l.isUrl(a.value||h.text(a))},klass:function(a,b,c){c=!1!==c;b=l.explode(b," ");c?f.each(b,function(b){a.classList.add(b)}):f.each(b,function(b){if("*"!==b)a.classList.remove(b);else return f.each(a.classList,function(a){this.remove(a)}),!1});return a},position:function(a){a=a||x.body;var b,c,d,e;b=c=0;e=a.offsetWidth;d=a.offsetHeight;if(a.offsetParent){c=a.offsetTop;for(b=
a.offsetLeft;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;a=x.body.offsetWidth-(b+e);d=x.body.offsetHeight-(c+d)}else a=e;return{top:c,right:a,bottom:d,left:b}},prependChild:function(a,b){return 0===a.childNodes.length?a.appendChild(b):a.insertBefore(b,a.childNodes[0])},removeAttr:function(a,b){var c;q.svg.test(a.namespaceURI)?a.removeAttributeNS(a.namespaceURI,b):"SELECT"===a.nodeName&&"selected"===b?(c=g.$("#"+a.id+' option[selected="selected"]')[0],void 0!==c&&(c.selected=!1,c.removeAttribute("selected"))):
a.removeAttribute(b);return a},serialize:function(a,b,c){a=g.object(a);b=!0===b;c=!1!==c;var d=[],e={},k;a instanceof Array?f.each(a,function(a){d.push(g.object(a))}):d="FORM"===a.nodeName?void 0!==a.elements?f.cast(a.elements):a.find("button, input, select, textarea"):[a];f.each(d,function(a){"FORM"===a.nodeName?g.merge(e,H.decode(h.serialize(a))):void 0===e[a.name]&&(e[a.name]=h.val(a))});b?(k="",g.iterate(e,function(a,b){c?k+="&"+encodeURIComponent(b)+"="+encodeURIComponent(a):k+="&"+b+"="+a}),
k=k.replace(q.and,"?")):k=H.encode(e);return k},show:function(a){"boolean"===typeof a.hidden?a.hidden=!1:a.style.display=h.data(a,"display")||"inherit";return a},size:function(a){var b=function(a){return u.parse(a,10)};return{height:a.offsetHeight+b(a.style.paddingTop||0)+b(a.style.paddingBottom||0)+b(a.style.borderTop||0)+b(a.style.borderBottom||0),width:a.offsetWidth+b(a.style.paddingLeft||0)+b(a.style.paddingRight||0)+b(a.style.borderLeft||0)+b(a.style.borderRight||0)}},text:function(a,b){var c=
void 0!==a.textContent?"textContent":"innerText",d={},e=!1;"undefined"!==typeof b&&(e=!0,d[c]=b);return e?h.update(a,d):a[c]},toggleClass:function(a,b){a.classList.toggle(b);return a},update:function(a,b){b=b||{};g.iterate(b,function(b,d){if(q.element_update.test(d))a[d]=b;else if("class"===d)l.isEmpty(b)?h.klass(a,"*",!1):h.klass(a,b);else if(0===d.indexOf("data-"))h.data(a,d.replace("data-",""),b);else if("id"===d){var e=m.listeners;void 0!==e[a.id]&&(e[d]=g.clone(e[a.id]),delete e[a.id])}else h.attr(a,
d,b)});return a},val:function(a,b){var c="input",d;if(void 0===b){if(q.radio_checkbox.test(a.type)){if(l.isEmpty(a.name))throw Error(t.error.expectedProperty);f.each(g.$("input[name='"+a.name+"']"),function(a){if(a.checked)return d=a.value,!1})}else d=q.select.test(a.type)?a.options[a.selectedIndex].value:a.value||h.text(a);void 0!==d&&(d=g.coerce(d));"string"===typeof d&&(d=l.trim(d))}else b=b.toString(),q.radio_checkbox.test(a.type)?(c="click",f.each(g.$("input[name='"+a.name+"']"),function(a){if(a.value===
b)return a.checked=!0,d=a,!1})):q.select.test(a.type)?(c="change",f.each(h.find(a,"> *"),function(a){if(a.value===b)return a.selected=!0,d=a,!1})):void 0!==a.value?a.value=b:h.text(a,b),h.dispatch(a,c),d=a;return d},validate:function(a){return"FORM"===a.nodeName?K.test(a):!l.isEmpty(a.value||h.text(a))}},ga={factory:function(a,b,c,d){d=d||250;var e=[b];if(!(a instanceof Element)||void 0!==b&&void 0===b.store||"string"!==typeof c||l.isEmpty(c))throw Error(t.error.invalidArguments);return(new Z(a,e[0],
d)).set(c).init()},methods:{init:function(){m.add(this.element,"keyup",this.update,"filter",this);m.add(this.element,"input",this.update,"value",this);return this},set:function(a){var b={};if("string"!==typeof a||l.isEmpty(a))throw Error(t.error.invalidArguments);f.each(l.explode(a),function(a){b[a]=""});this.filters=b;return this},teardown:function(){m.remove(this.element,"keyup","filter");m.remove(this.element,"input","value");return this},update:function(){var a=this;g.defer(function(){var b=h.val(a.element);
l.isEmpty(b)?a.datalist.filter=null:(g.iterate(a.filters,function(a,d){var e=l.explode(b),e=e.filter(function(a){return!l.isEmpty(a)});f.each(e,function(a,b){this[b]="^"+l.escape(a).replace("\\*",".*")});this[d]=e.join(",")}),a.datalist.filter=a.filters);a.datalist.pageIndex=1;a.datalist.refresh(!0,1<a.datalist.store.datalists.length)},this.debounce,this.element.id+"Debounce");return this}}};Z.prototype=ga.methods;Z.prototype.constructor=Z;$.prototype={dump:function(){return this.store.dump(this.list.records,
this.fields)},init:function(a){var b,c,d,e,k,g,s,p;this.initialized||(b=this,c=[],d="",e=h.create("section",{"class":"grid"},this.element),k=h.create("ul",{"class":"header"},e),g=100/this.fields.length+"%",s="display:inline-block;width:"+g,p=l.explode(this.options.order),f.each(this.fields,function(a){var c=k.create("span",{innerHTML:l.capitalize(l.unCamelCase(l.unhyphenate(a,!0)),!0),style:s,"class":a,"data-field":a});b.sortable.contains(a)&&(h.klass(c,"sortable",!0),0<p.filter(function(b){return 0===
b.indexOf(a)}).length&&h.data(c,"sort",f.contains(p,a+" desc")?"desc":"asc"));d+='<span class="'+a+'" data-field="'+a+'" style="'+s+'">{{'+a+"}}</span>"}),0<this.sortable.length&&m.add(k,"click",this.sort,"sort",this),c.push(S.factory(e,this.store,d,this.options)),this.list=c[0],!0===this.filtered&&(c.push(ga.factory(h.create("input",{"class":"filter"},e,"first"),c[0],this.fields.join(","),a||250)),this.filter=c[1]),this.initialized=!0);return this},refresh:function(){var a=[],b=this;0<this.sortOrder.length&&
(f.each(this.sortOrder,function(c){var d=h.find(b.element,".header span[data-field='"+c+"']")[0];a.push(l.trim(c+" "+(h.data(d,"sort")||"")))}),this.options.order=this.list.order=a.join(", "));this.list.where=null;g.merge(this.list,this.options);this.list.refresh();return this},sort:function(a){var b=g.target(a);g.stop(a);h.hasClass(b,"sortable")&&(a=h.data(b,"field"),h.data(b,"sort","asc"===h.data(b,"sort")?"desc":"asc"),f.remove(this.sortOrder,a),this.sortOrder.splice(0,0,a),this.refresh());return this},
teardown:function(){null!==this.filter&&this.filter.teardown();this.list.teardown();m.remove(h.find(this.element,".header")[0],"click","sort");h.destroy(h.find(this.element,".grid")[0]);return this}};$.prototype.constructor=$;var H={csv:function(a,b,c){b=b||",";c=!1!==c;a=H.decode(a,!0)||a;var d="",e;e=function(a){var c;a instanceof Array?(c='"'+a.toString()+'"',q.object_type.test(c)&&(c='"'+H.csv(a,b)+'"')):c=a instanceof Object?'"'+H.csv(a,b)+'"':q.csv_quote.test(a)?'"'+a.replace(/"/g,'""')+'"':
a;return c};a instanceof Array?a[0]instanceof Object?(c&&(d=f.keys(a[0]).join(b)+"\n"),d+=a.map(function(a){return H.csv(a,b,!1)}).join("\n")):d+=e(a,b)+"\n":(c&&(d=f.keys(a).join(b)+"\n"),d+=f.cast(a).map(e).join(b)+"\n");return d.replace(/\n$/,"")},decode:function(a,b){try{return JSON.parse(a)}catch(c){!0!==b&&g.error(c,arguments,this)}},encode:function(a,b){try{return JSON.stringify(a)}catch(c){!0!==b&&g.error(c,arguments,this)}}},t={common:{back:"Back",cancel:"Cancel",clear:"Clear",close:"Close",
cont:"Continue",create:"Create",del:"Delete",edit:"Edit",find:"Find",gen:"Generate",go:"Go",loading:"Loading",next:"Next",login:"Login",ran:"Random",reset:"Reset",save:"Save",search:"Search",submit:"Submit"},day:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},error:{databaseNotOpen:"Failed to open the Database, possibly exceeded Domain quota",databaseNotSupported:"Client does not support local database storage",databaseWarnInjection:"Possible SQL injection in database transaction, use the &#63; placeholder",
databaseMoreThanOne:"More than one match found",elementNotCreated:"Could not create the Element",elementNotFound:"Could not find the Element",expectedArray:"Expected an Array",expectedArrayObject:"Expected an Array or Object",expectedBoolean:"Expected a Boolean value",expectedNumber:"Expected a Number",expectedProperty:"Expected a property, and it was not set",expectedObject:"Expected an Object",invalidArguments:"One or more arguments is invalid",invalidDate:"Invalid Date",invalidFields:"The following required fields are invalid: ",
invalidRoute:"The route could not be found",invalidStateNoHeaders:"INVALID_STATE_ERR: Headers have not been received",invalidStateNoSync:"Synchronous XMLHttpRequest requests are not supported",invalidStateNotOpen:"INVALID_STATE_ERR: Object is not open",invalidStateNotSending:"INVALID_STATE_ERR: Object is sending",invalidStateNotUsable:"INVALID_STATE_ERR: Object is not usable",notAvailable:"Requested method is not available",notSupported:"This feature is not supported by this platform",propertyNotFound:"Could not find the requested property",
promisePending:"The promise cannot be resolved while pending result",promiseResolved:"The promise has been resolved: {{outcome}}",serverError:"Server error has occurred",serverForbidden:"Forbidden to access URI",serverInvalidMethod:"Method not allowed",serverUnauthorized:"Authorization required to access URI",readOnly:"Property is read only",upgrade:"Your browser is too old to use abaaso, please upgrade"},month:{0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",
9:"October",10:"November",11:"December"}};aa.prototype={evict:function(){null!==this.last&&this.remove(this.last);return this},get:function(a){var b=this.cache[a];if(void 0!==b)return this.set(a,b.value),b.value},remove:function(a){var b=this.cache[a];void 0!==b&&(delete this.cache[a],this.length--,null!==b.previous&&(this.cache[b.previous].next=b.next),null!==b.next&&(this.cache[b.next].previous=b.previous),this.first===a&&(this.first=b.previous),this.last===a&&(this.last=b.next));return b},set:function(a,
b){var c=this.remove(a);void 0===c?c=new ca(b):c.value=b;c.next=null;c.previous=this.first;this.cache[a]=c;null!==this.first&&(this.cache[this.first].next=a);this.first=a;null===this.last&&(this.last=a);++this.length>this.max&&this.evict();return this}};aa.prototype.constructor=aa;ca.prototype.constructor=ca;var G={enabled:!1,log:!1,diff:{x:null,y:null},pos:{x:null,y:null},prev:{x:null,y:null},view:function(){return r.ie&&9>r.version?"documentElement":"body"},track:function(a){var b=typeof a;if("object"===
b){var c=x[G.view],b=a.pageX?a.pageX:c.scrollLeft+a.clientX;a=a.pageY?a.pageY:c.scrollTop+a.clientY;c=!1;G.pos.x!==b&&(c=!0);B.mouse.prev.x=G.prev.x=u.parse(G.pos.x,10);B.mouse.pos.x=G.pos.x=b;B.mouse.diff.x=G.diff.x=G.pos.x-G.prev.x;G.pos.y!==a&&(c=!0);B.mouse.prev.y=G.prev.y=u.parse(G.pos.y,10);B.mouse.pos.y=G.pos.y=a;B.mouse.diff.y=G.diff.y=G.pos.y-G.prev.y;c&&B.mouse.log&&g.log([G.pos.x,G.pos.y,G.diff.x,G.diff.y])}else"boolean"===b&&(a?m.add(x,"mousemove",G.track,"tracking"):m.remove(x,"mousemove",
"tracking"),B.mouse.enabled=G.enabled=a);return B.mouse}},u={diff:function(a,b){if(isNaN(a)||isNaN(b))throw Error(t.error.expectedNumber);return Math.abs(a-b)},even:function(a){return 0===a%2},format:function(a,b,c){if(isNaN(a))throw Error(t.error.expectedNumber);a=a.toString();b=b||",";c=c||3;var d=-1<a.indexOf(".")?"."+a.replace(q.number_format_1,""):"";a=a.replace(q.number_format_2,"").split("").reverse();var e=Math.floor(a.length/c),f=1,g,h;for(h=0;h<e;h++)g=1===f?c:c*f+(2===f?1:f-1),a.splice(g,
0,b),f++;a=a.reverse().join("");a.charAt(0)===b&&(a=a.substring(1));return a+d},half:function(a,b){return void 0!==b?0.5===a/b:a/2},odd:function(a){return!u.even(a)},parse:function(a,b){return void 0===b?parseFloat(a):parseInt(a,b)},random:function(a){a=a||100;return Math.floor(Math.random()*(a+1))},round:function(a,b){a=u.parse(a);return void 0===b||l.isEmpty(b)?u.parse(a.toFixed(0)):Math[q.down.test(b)?"floor":"ceil"](a)}},m={listeners:{},alisteners:{},elisteners:{},clisteners:{},log:!1,queue:[],
silent:!1,ignore:!1,add:function(a,b,c,d,e,k){a=g.object(a);e=e||a;k=k||F.getCurrent();if(a instanceof Array)return f.each(a,function(a){m.add(a,b,c,d,e,k)});void 0!==b&&(b=l.explode(b));d=d||g.genId();var n=null,h=m.listeners,p=m.alisteners,r=m.elisteners,u=m.clisteners,A=q.observer_globals,v=q.observer_allowed,C=m.id(a),w,x;if(void 0===C||null===b||void 0===b||"function"!==typeof c)throw Error(t.error.invalidArguments);void 0===h[C]&&(h[C]={},p[C]={},u[C]={});f.each(b,function(b){var f=C+"_"+b;
void 0===h[C][b]&&(h[C][b]={},p[C][b]={},u[C][b]=0);void 0===h[C][b][k]&&(h[C][b][k]={},p[C][b][k]=[]);n=A.test(C)||!/\//g.test(C)&&"abaaso"!==C?a:null;null!==n&&(void 0!==n&&"afterjsonp"!==b.toLowerCase()&&void 0===r[f]&&(A.test(C)||"function"===typeof n.listeners))&&(w="function"===typeof n.addEventListener,x="object"===typeof n.attachEvent||w)&&(r[f]=function(c){v.test(c.type)||g.stop(c);m.fire(a,b,c)},n[w?"addEventListener":"attachEvent"]((w?"":"on")+b,r[f],!1));h[C][b][k][d]={fn:c,scope:e};m.sync(C,
b,k);u[C][b]++});return a},decorate:function(a){f.each([["fire",function(){return m.fire.apply(m,[this].concat(f.cast(arguments)))}],["listeners",function(a){return m.list(this,a)}],["on",function(a,c,d,e,f){return m.add(this,a,c,d,e,f)}],["once",function(a,c,d,e,f){return m.once(this,a,c,d,e,f)}],["un",function(a,c){return m.remove(this,a,c)}]],function(b){g.property(a,b[0],{value:b[1],configurable:!0,enumerable:!0,writable:!0})});return a},discard:function(a){return void 0===a?m.ignore:m.ignore=
!0===a},fire:function(a,b){a=g.object(a);var c=!1,d=f.cast(arguments).remove(0,1),e,k,n,h;if(m.ignore)return a;if(a instanceof Array)return f.each(a,function(a){m.fire.apply(m,[a,b].concat(d))}),a;e=m.id(a);if(void 0===e||void 0===b)throw Error(t.error.invalidArguments);m.silent?m.queue.push({obj:a,event:b}):(k=F.getCurrent(),n=B.logging,f.each(l.explode(b),function(b){n&&g.log(e+" firing "+b);h=m.list(a,b,m.alisteners);void 0!==h.all&&f.each(h.all,function(a){a=a.fn.apply(a.scope,d);if(!1===a)return c=
!0,a});c||("all"===k||void 0===h[k])||f.each(h[k],function(a){return a.fn.apply(a.scope,d)})}));return a},id:function(a){a===D?a="window":w||a!==x?w||a!==x.body?(g.genId(a),a=a.id||("function"===typeof a.toString?a.toString():a)):a="body":a="document";return a},list:function(a,b,c){a=g.object(a);c=c||m.listeners;a=m.id(a);return void 0===c[a]&&void 0===b?{}:void 0===c[a]||void 0!==b&&!l.isEmpty(b)?void 0!==c[a]&&void 0!==c[a][b]?c[a][b]:{}:c[a]},once:function(a,b,c,d,e,k){var n=d||g.genId();a=g.object(a);
e=e||a;k=k||F.getCurrent();if(void 0===a||null===b||void 0===b||"function"!==typeof c)throw Error(t.error.invalidArguments);if(a instanceof Array)return f.each(a,function(a){m.once(a,b,c,d,e,k)}),a;m.add(a,b,function(){c.apply(e,arguments);m.remove(a,b,n,k)},n,e,k);return a},pause:function(a){!0===a?m.silent=a:!1===a&&(m.silent=a,f.each(m.queue,function(a){m.fire(a.obj,a.event)}),m.queue=[]);return a},remove:function(a,b,c,d){a=g.object(a);d=d||F.getCurrent();if(a instanceof Array)return f.each(a,
function(a){m.remove(a,b,c,d)});var e=m.listeners,k=m.alisteners,n=m.elisteners,h=m.clisteners,p=m.id(a),r="function"===typeof a.addEventListener,t="object"===typeof a.attachEvent||r,u;u=function(b,c){"number"===typeof c&&0===(h[p][b]-=c)&&t&&(a[r?"removeEventListener":"detachEvent"]((r?"":"on")+b,n[p+"_"+b],!1),delete n[p+"_"+b])};if(void 0===e[p])return a;void 0===b||null===b?((q.observer_globals.test(p)||"function"===typeof p.listeners)&&g.iterate(n,function(a,b){0===b.indexOf(p+"_")&&u(b.replace(/.*_/,
""),1)}),delete e[p],delete k[p],delete h[p]):f.each(l.explode(b),function(a){var b=!1;void 0!==e[p][a]&&(void 0===c?((q.observer_globals.test(p)||"function"===typeof p.listeners)&&u(a,f.keys(e[p][a][d]).length),e[p][a][d]={},b=!0):void 0!==e[p][a][d][c]&&(u(a,1),delete e[p][a][d][c],b=!0),b&&m.sync(p,a,d))});return a},sum:function(a){var b={};void 0!==a?(a=g.object(a),a=m.id(a),b=g.clone(m.clisteners[a])):b=g.clone(m.clisteners);return b},sync:function(a,b,c){m.alisteners[a][b][c]=f.cast(m.listeners[a][b][c])}},
z={delay:function(){return"undefined"!==typeof setImmediate?setImmediate:"undefined"!==typeof process?process.nextTick:g.defer},factory:function(){return new Q},freeze:"function"===typeof Object.freeze,methods:{reject:function(a){var b=this;z.delay(function(){z.resolve.call(b,z.state.broken,a)});return this},resolve:function(a){var b=this;z.delay(function(){z.resolve.call(b,z.state.resolved,a)});return this},resolved:function(){return this.state===z.state.broken||this.state===z.state.resolved},then:function(a,
b){var c=this,d=z.factory(),e;e=function(e){var h=e?a:b;e=e?!1:!0;var s;try{s=h.call(void 0,c.outcome),e=!1}catch(p){s=p,e=!0,void 0===s||(null===s||s instanceof Error)||("object"===typeof s&&(s=H.encode(s)),s=Error(s)),g.error(s,[c.outcome],c)}finally{if(s instanceof Q)c.state=z.state.pending,c.outcome=null,s.parentNode=c,s.then(function(a){f.each(c.childNodes,function(b){b.resolve(a)})},function(a){f.each(c.childNodes,function(b){b.reject(a)})});else{if(e&&void 0===s)throw Error(t.error.invalidArguments);
d[e?"reject":"resolve"](s||c.outcome)}return s}};"function"===typeof a&&z.vouch.call(this,z.state.resolved,function(){return e(!0)});"function"===typeof b&&z.vouch.call(this,z.state.broken,function(){return e(!1)});d.parentNode=c;c.childNodes.push(d);return d}},resolve:function(a,b){var c=a===z.state.broken?"error":"fulfill",d=this,e=!1,k=!1,g=[],h,p,l;if(this.state!==z.state.pending){if(null!==this.parentNode&&this.parentNode.state===z.state.resolved||0<this.childNodes.length)return;throw Error(t.error.promiseResolved.replace("{{outcome}}",
this.outcome));}this.state=a;this.outcome=b;f.each(this[c],function(c,f){l=c.call(d,b);g.push(f);if(l instanceof Q)return e=!0,d.outcome=null,d.state=z.state.pending,!1;l instanceof Error&&(k=!0,p=l,a=z.state.broken)});if(e){for(h=g.length;h--;)f.remove(d[c],g[h]);return l}this.error=[];this.fulfill=[];k||(l=p,a=z.state.resolved);if(null!==this.parentNode&&this.parentNode.state===z.state.pending)this.parentNode[a===z.state.resolved?"resolve":"reject"](l||this.outcome);z.freeze&&Object.freeze(this);
return this},state:{broken:"rejected",pending:"pending",resolved:"fulfilled"},vouch:function(a,b){if(l.isEmpty(a))throw Error(t.error.invalidArguments);this.state===z.state.pending?this[a===z.state.resolved?"fulfill":"error"].push(b):this.state===a&&b(this.outcome);return this}};Q.prototype=z.methods;Q.prototype.constructor=Q;var ha={array:{add:function(a){return f.add(this,a)},addClass:function(a){return f.each(this,function(b){h.klass(b,a)})},after:function(a,b){var c=[];f.each(this,function(d){c.push(h.create(a,
b,d,"after"))});return c},append:function(a,b){var c=[];f.each(this,function(d){c.push(h.create(a,b,d,"last"))});return c},attr:function(a,b){var c=[];f.each(this,function(d){c.push(h.attr(d,a,b))});return c},before:function(a,b){var c=[];f.each(this,function(d){c.push(h.create(a,b,d,"before"))});return c},binIndex:function(a){return f.binIndex(this,a)},chunk:function(a){return f.chunk(this,a)},clear:function(){return!w&&this[0]instanceof Element?f.each(this,function(a){h.clear(a)}):f.clear(this)},
clone:function(){return g.clone(this)},collect:function(a){return f.collect(this,a)},compact:function(){return f.compact(this)},contains:function(a){return f.contains(this,a)},count:function(a){return f.count(this,a)},create:function(a,b,c){var d=[];f.each(this,function(e){d.push(h.create(a,b,e,c))});return d},css:function(a,b){return f.each(this,function(c){h.css(c,a,b)})},data:function(a,b){var c=[];f.each(this,function(d){c.push(h.data(d,a,b))});return c},diff:function(a){return f.diff(this,a)},
disable:function(){return f.each(this,function(a){h.disable(a)})},dispatch:function(a,b,c,d){return f.each(this,function(e){h.dispatch(e,a,b,c,d)})},destroy:function(){f.each(this,function(a){h.destroy(a)});return[]},each:function(a,b,c){return f.each(this,a,b,c)},empty:function(){return f.empty(this)},enable:function(){return f.each(this,function(a){h.enable(a)})},equal:function(a){return f.equal(this,a)},fib:function(a){return f.fib(a)},fill:function(a,b,c){return f.fill(this,a,b,c)},find:function(a){var b=
[];f.each(this,function(c){c.find(a).each(function(a){b.add(a)})});return b},fire:function(){var a=arguments;return f.each(this,function(b){m.fire.apply(m,[b].concat(f.cast(a)))})},first:function(){return f.first(this)},flat:function(){return f.flat(this)},genId:function(){return f.each(this,function(a){g.genId(a)})},get:function(a,b){var c=[];f.each(this,function(d,e){d.get(a,b,function(a){c[e]=a},function(a){c[e]=a})});return c},has:function(a){var b=[];f.each(this,function(c){b.push(h.has(c,a))});
return b},hasClass:function(a){var b=[];f.each(this,function(c){b.push(h.hasClass(c,a))});return b},html:function(a){var b;if(void 0!==a)return f.each(this,function(b){h.html(b,a)});b=[];f.each(this,function(a){b.push(h.html(a))});return b},index:function(a){return f.index(this,a)},indexed:function(){return f.indexed(this)},intersect:function(a){return f.intersect(this,a)},is:function(a){var b=[];f.each(this,function(c){b.push(h.is(c,a))});return b},isAlphaNum:function(){var a=[];f.each(this,function(b){a.push(b.isAlphaNum())});
return a},isBoolean:function(){var a=[];f.each(this,function(b){a.push(b.isBoolean())});return a},isChecked:function(){var a=[];f.each(this,function(b){a.push(b.isChecked())});return a},isDate:function(){var a=[];f.each(this,function(b){a.push(b.isDate())});return a},isDisabled:function(){var a=[];f.each(this,function(b){a.push(h.isDisabled(b))});return a},isDomain:function(){var a=[];f.each(this,function(b){a.push(b.isDomain())});return a},isEmail:function(){var a=[];f.each(this,function(b){a.push(b.isEmail())});
return a},isEmpty:function(){var a=[];f.each(this,function(b){a.push(b.isEmpty())});return a},isHidden:function(){var a=[];f.each(this,function(b){a.push(h.isHidden(b))});return a},isIP:function(){var a=[];f.each(this,function(b){a.push(b.isIP())});return a},isInt:function(){var a=[];f.each(this,function(b){a.push(b.isInt())});return a},isNumber:function(){var a=[];f.each(this,function(b){a.push(b.isNumber())});return a},isPhone:function(){var a=[];f.each(this,function(b){a.push(b.isPhone())});return a},
isUrl:function(){var a=[];f.each(this,function(b){a.push(b.isUrl())});return a},keepIf:function(a){return f.keepIf(this,a)},keys:function(){return f.keys(this)},last:function(a){return f.last(this,a)},limit:function(a,b){return f.limit(this,a,b)},listeners:function(a){var b=[];f.each(this,function(c){f.merge(b,m.listeners(c,a))});return b},loading:function(){return f.each(this,function(a){g.loading(a)})},max:function(){return f.max(this)},mean:function(){return f.mean(this)},median:function(){return f.median(this)},
merge:function(a){return f.merge(this,a)},min:function(){return f.min(this)},mingle:function(a){return f.mingle(this,a)},mode:function(){return f.mode(this)},on:function(a,b,c,d,e){return f.each(this,function(f){m.add(f,a,b,c,d||f,e)})},once:function(a,b,c,d,e){return f.each(this,function(f){m.once(f,a,b,c,d||f,e)})},percents:function(a,b){return f.percents(this,a,b)},position:function(){var a=[];f.each(this,function(b){a.push(h.position(b))});return a},prepend:function(a,b){var c=[];f.each(this,
function(d){c.push(h.create(a,b,d,"first"))});return c},range:function(){return f.range(this)},rassoc:function(a){return f.rassoc(this,a)},reject:function(a){return f.reject(this,a)},remove:function(a,b){return f.remove(this,a,b)},removeIf:function(a){return f.removeIf(this,a)},removeWhile:function(a){return f.removeWhile(this,a)},removeAttr:function(a){f.each(this,function(b){h.removeAttr(b,a)});return this},removeClass:function(a){return f.each(this,function(b){h.klass(b,a,!1)})},replace:function(a){return f.replace(this,
a)},rest:function(a){return f.rest(this,a)},rindex:function(a){return f.rindex(this,a)},rotate:function(a){return f.rotate(this,a)},serialize:function(a,b){return h.serialize(this,a,b)},series:function(a,b,c){return f.series(a,b,c)},show:function(){return f.each(this,function(a){h.show(a)})},size:function(){var a=[];f.each(this,function(b){a.push(h.size(b))});return a},sorted:function(){return f.sorted(this)},split:function(a){return f.split(this,a)},sum:function(){return f.sum(this)},take:function(a){return f.take(this,
a)},text:function(a){return f.each(this,function(b){"object"!==typeof b&&(b=g.object(b));"function"===typeof b.text&&b.text(a)})},tpl:function(a){return f.each(this,function(b){g.tpl(a,b)})},toggleClass:function(a){return f.each(this,function(b){h.toggleClass(b,a)})},total:function(){return f.total(this)},toObject:function(){return f.toObject(this)},un:function(a,b,c){return f.each(this,function(d){m.remove(d,a,b,c)})},unique:function(){return f.unique(this)},update:function(a){return f.each(this,
function(b){h.update(b,a)})},val:function(a){var b=[],c=null,d=!0;f.each(this,function(e){null!==c&&(d=c===e.type);c=e.type;"function"===typeof e.val&&b.push(h.val(e,a))});return d?b[0]:b},validate:function(){var a=[];f.each(this,function(b){a.push(h.validate(b))});return a},zip:function(){return f.zip(this,arguments)}},element:{addClass:function(a){return h.klass(this,a,!0)},after:function(a,b){return h.create(a,b,this,"after")},append:function(a,b){return h.create(a,b,this,"last")},attr:function(a,
b){return h.attr(this,a,b)},before:function(a,b){return h.create(a,b,this,"before")},clear:function(){return h.clear(this)},create:function(a,b,c){return h.create(a,b,this,c)},css:function(a,b){return h.css(this,a,b)},data:function(a,b){return h.data(this,a,b)},destroy:function(){return h.destroy(this)},disable:function(){return h.disable(this)},dispatch:function(a,b,c,d){return h.dispatch(this,a,b,c,d)},enable:function(){return h.enable(this)},find:function(a){return h.find(this,a)},fire:function(){return m.fire.apply(m,
[this].concat(f.cast(arguments)))},genId:function(){return g.genId(this)},get:function(a,b,c,d,e){var f=this,g=I.factory();g.then(function(a){h.html(f,a);m.fire(f,"afterGet");"function"===typeof b&&b.call(f,a)},function(a){h.html(f,a||t.error.serverError);m.fire(f,"failedGet");"function"===typeof c&&c.call(f,a);throw a;});m.fire(this,"beforeGet");a.get(function(a){g.resolve(a)},function(a){g.reject(a)},d,e);return g},has:function(a){return h.has(this,a)},hasClass:function(a){return h.hasClass(this,
a)},html:function(a){return h.html(this,a)},is:function(a){return h.is(this,a)},isAlphaNum:function(){return h.isAlphaNum(this)},isBoolean:function(){return h.isBoolean(this)},isChecked:function(){return h.isChecked(this)},isDate:function(){return h.isDate(this)},isDisabled:function(){return h.isDisabled(this)},isDomain:function(){return h.isDomain(this)},isEmail:function(){return h.isEmail(this)},isEmpty:function(){return h.isEmpty(this)},isHidden:function(){return h.hidden(this)},isIP:function(){return h.isIP(this)},
isInt:function(){return h.isInt(this)},isNumber:function(){return h.isNumber(this)},isPhone:function(){return h.isPhone(this)},isUrl:function(){return h.isUrl(this)},jsonp:function(a,b,c){var d=this;return r.jsonp(a,function(a){var c=a,f=b,s;try{void 0!==f?(f=f.replace(/\]|'|"/g,"").replace(/\./g,"[").split("["),f.each(function(a){c=c[isNaN(a)?a:u.parse(a,10)];if(void 0===c)throw Error(t.error.propertyNotFound);}),s=c):s=a}catch(l){s=t.error.serverError,g.error(l,arguments,this)}h.html(d,s)},function(a){h.html(d,
t.error.serverError);throw a;},c)},listeners:function(a){return m.list(this,a)},loading:function(){return g.loading(this)},on:function(a,b,c,d,e){return m.add(this,a,b,c,d||this,e)},once:function(a,b,c,d,e){return m.once(this,a,b,c,d||this,e)},prepend:function(a,b){return h.create(a,b,this,"first")},prependChild:function(a){return h.prependChild(this,a)},position:function(){return h.position(this)},removeAttr:function(a){return h.removeAttr(this,a)},removeClass:function(a){return h.klass(this,a,!1)},
serialize:function(a,b){return h.serialize(this,a,b)},show:function(){return h.show(this)},size:function(){return h.size(this)},text:function(a){return h.text(this,a)},toggleClass:function(a){return h.toggleClass(this,a)},tpl:function(a){return g.tpl(a,this)},un:function(a,b,c){return m.remove(this,a,b,c)},update:function(a){return h.update(this,a)},val:function(a){return h.val(this,a)},validate:function(){return h.validate(this)}},"function":{reflect:function(){return g.reflect(this)},debounce:function(a){return g.debounce(this,
a)}},number:{diff:function(a){return u.diff(this,a)},fire:function(){return m.fire.apply(m,[this.toString()].concat(f.cast(arguments)))},format:function(a,b){return u.format(this,a,b)},half:function(a){return u.half(this,a)},isEven:function(){return u.even(this)},isOdd:function(){return u.odd(this)},listeners:function(a){return m.list(this.toString(),a)},on:function(a,b,c,d,e){m.add(this.toString(),a,b,c,d||this,e);return this},once:function(a,b,c,d,e){m.once(this.toString(),a,b,c,d||this,e);return this},
random:function(){return u.random(this)},round:function(){return u.round(this)},roundDown:function(){return u.round(this,"down")},roundUp:function(){return u.round(this,"up")},un:function(a,b,c){m.remove(this.toString(),a,b,c);return this}},string:{allows:function(a){return r.allows(this,a)},capitalize:function(a){return l.capitalize(this,a)},del:function(a,b,c){return r.request(this,"DELETE",a,b,null,c)},escape:function(){return l.escape(this)},expire:function(a){return y.expire(this,a)},explode:function(a){return l.explode(this,
a)},fire:function(){return m.fire.apply(m,[this].concat(f.cast(arguments)))},get:function(a,b,c){return r.request(this,"GET",a,b,null,c)},headers:function(a,b){return r.request(this,"HEAD",a,b)},hyphenate:function(a){return l.hyphenate(this,a)},isAlphaNum:function(){return l.isAlphaNum(this)},isBoolean:function(){return l.isBoolean(this)},isDate:function(){return l.isDate(this)},isDomain:function(){return l.isDomain(this)},isEmail:function(){return l.isEmail(this)},isEmpty:function(){return l.isEmpty(this)},
isIP:function(){return l.isIP(this)},isInt:function(){return l.isInt(this)},isNumber:function(){return l.isNumber(this)},isPhone:function(){return l.isPhone(this)},isUrl:function(){return l.isUrl(this)},jsonp:function(a,b,c){return r.jsonp(this,a,b,c)},listeners:function(a){return m.list(this,a)},patch:function(a,b,c,d){return r.request(this,"PATCH",a,b,c,d)},post:function(a,b,c,d){return r.request(this,"POST",a,b,c,d)},put:function(a,b,c,d){return r.request(this,"PUT",a,b,c,d)},on:function(a,b,c,
d,e){return m.add(this,a,b,c,d,e)},once:function(a,b,c,d,e){return m.add(this,a,b,c,d,e)},options:function(a,b){return r.request(this,"OPTIONS",a,b)},permissions:function(){return r.permissions(this)},singular:function(){return l.singular(this)},toCamelCase:function(){return l.toCamelCase(this)},toNumber:function(a){return u.parse(this,a)},trim:function(){return l.trim(this)},un:function(a,b,c){return m.remove(this,a,b,c)},unCamelCase:function(){return l.unCamelCase(this)},uncapitalize:function(){return l.uncapitalize(this)},
unhyphenate:function(a){return l.unhyphenate(this,a)}}},v={current:"",initial:null,reg:RegExp(),routes:{},method:function(a){return q.route_methods.test(a)?a.toLowerCase():"all"},del:function(a,b,c){c=c||"all";b=v.method(b);var d="error"===a;if(d&&"all"!==b||!d&&v.routes[c][b].hasOwnProperty(a))return v.initial===a&&(v.initial=null),delete v.routes[c][b][a];throw Error(t.error.invalidArguments);},hash:function(a){var b="";w||(void 0===a?b=x.location.hash.replace(q.hash_bang,""):(b=a.replace(q.hash_bang,
""),x.location.hash="!"+b));return b},hostname:function(a){v.routes.hasOwnProperty(a)||(v.routes[a]={all:{},"delete":{},get:{},post:{},put:{}});return v.routes[a]},init:function(){var a=x.location.hash;l.isEmpty(a)?v.hash(null!==v.initial?v.initial:f.cast(v.routes.all.all,!0).remove("error")[0]):v.load(a)},list:function(a,b){b=b||"all";var c;w?void 0!==a?c=f.cast(v.routes[v.routes[b]?b:"all"][v.method(a)],!0):(c={},v.routes.hasOwnProperty(b)&&g.iterate(v.routes[b],function(a,b){c[b]=[];g.iterate(a,
function(a,d){c[b].push(d)})})):c=f.cast(v.routes.all.all,!0);return c},load:function(a,b,c,d){b=b||"all";d=d||"all";var e="",k="",h=!0,s=!1,p=v.method(b.method||b),m,r;q.route_nget.test(p)&&(p="get");a=a.replace(/^\#\!?|\?.*|\#.*/g,"");w||(v.current=a);m=function(a,b,c){void 0!==v.routes[a][b][c]?(e=c,k=b):"all"!==b&&void 0!==v.routes[a].all[c]?(e=c,k="all"):(g.iterate(v.routes[a][b],function(a,d){return r(d,b,c)}),l.isEmpty(e)&&"all"!==b&&g.iterate(v.routes[a].all,function(a,b){return r(b,"all",
c)}))};r=function(a,b,c){if(g.compile(v.reg,"^"+a+"$")&&v.reg.test(c))return e=a,k=b,!1};"all"===d||v.routes.hasOwnProperty(d)||(f.each(f.cast(v.routes,!0),function(a){if(RegExp(a.replace(/^\*/g,".*")).test(d))return d=a,s=!0,!1}),s||(d="all"));m(d,p,a);l.isEmpty(e)&&("all"!==d&&(d="all",m(d,p,a)),l.isEmpty(e)&&(e="error",k="all",h=!1));v.routes[d][k][e](b||e,c);return h},reset:function(){v.routes={all:{all:{error:function(){if(w)throw Error(t.error.invalidRoute);if(l.isEmpty(v.hash()))return history.go(-1);
g.error(t.error.invalidRoute);null!==v.initial&&v.hash(v.initial)}},"delete":{},get:{},put:{},post:{}}}},server:function(a,b,c){var d,e;if(!w)throw Error(t.error.notSupported);a=a||{};c=!0===c||443===a.port;d=function(a,b){var c=ba.parse(a.url),d=a.headers.host.replace(q.header_replace,"");v.load(c.pathname,a,b,d)};e=function(d){g.error(d,[a,b,c]);"function"===typeof b&&b(d)};v.enabled=!0;a.host=a.host||void 0;a.port=a.port||8E3;c?(V.globalAgent.maxConnections=a.maxConnections,d=V.createServer(a,
d).on("error",e).listen(a.port)):(U.globalAgent.maxConnections=a.maxConnections||25,d=U.createServer(d).on("error",e).listen(a.port,a.host));d.maxConnections&&(d.maxConnections=a.maxConnections||25);return d},set:function(a,b,c,d){d=w?d||"all":"all";c=w?v.method(c):"all";if("string"!==typeof a||l.isEmpty(a)||"function"!==typeof b)throw Error(t.error.invalidArguments);v.hostname(d)[c][a]=b;return!0}},F=function(){var a={current:"active",previous:null,header:null};return{getCurrent:function(){return a.current},
setCurrent:function(b){if(null===b||"string"!==typeof b||a[0]===b||l.isEmpty(b))throw Error(t.error.invalidArguments);a.previous=a.current;a.current=b;m.fire(M,"state",b);return b},getHeader:function(){return a.header},setHeader:function(b){if(null!==b&&("string"!==typeof b||a.header===b||l.isEmpty(b)))throw Error(t.error.invalidArguments);return a.header=b},getPrevious:function(){return a.previous},setPrevious:function(){throw Error(t.error.readOnly);}}}(),l={capitalize:function(a,b){a=l.trim(a);
return!0===b?l.explode(a," ").map(function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join(" "):a.charAt(0).toUpperCase()+a.slice(1)},escape:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^\$|#\s]/g,"\\$&")},explode:function(a,b){if(void 0===b||""===b.toString())b=",";return l.isEmpty(a)?[]:l.trim(a).split(RegExp("\\s*"+b+"\\s*"))},hyphenate:function(a,b){var c=l.trim(a).replace(/\s+/g,"-");!0===b&&(c=c.replace(/([A-Z])/g,"-$1").toLowerCase());return c},isAlphaNum:function(a){return K.test({alphanum:a}).pass},
isBoolean:function(a){return K.test({"boolean":a}).pass},isDate:function(a){return K.test({date:a}).pass},isDomain:function(a){return K.test({domain:a}).pass},isEmail:function(a){return K.test({email:a}).pass},isEmpty:function(a){return void 0!==a?""===l.trim(a):!0},isIP:function(a){return K.test({ip:a}).pass},isInt:function(a){return K.test({integer:a}).pass},isNumber:function(a){return K.test({number:a}).pass},isPhone:function(a){return K.test({phone:a}).pass},isUrl:function(a){return K.test({url:a}).pass},
singular:function(a){return q.plural.test(a)?a.slice(0,-1):a},toCamelCase:function(a){a=l.trim(a).replace(/\.|_|-|\@|\[|\]|\(|\)|\#|\$|\%|\^|\&|\*|\s+/g," ").toLowerCase().split(q.space_hyphen);var b=[];f.each(a,function(a,d){b.push(0===d?a:l.capitalize(a))});return b.join("")},trim:function(a){return a.toString().replace(/^(\s+|\t+)|(\s+|\t+)$/g,"")},unCamelCase:function(a){return l.trim(a.replace(/([A-Z])/g," $1").toLowerCase())},uncapitalize:function(a){a=l.trim(a);return a.charAt(0).toLowerCase()+
a.slice(1)},unhyphenate:function(a,b){b=!0===b;var c="";-1<a.indexOf("-")?f.each(l.trim(a).split("-"),function(a){c+=(b?l.capitalize(a):a)+" "}):c=b?l.capitalize(a):a;return l.trim(c)}},g={timer:{},repeating:{},$:function(a){var b;if(void 0!==a)return a=l.trim(a),-1===a.indexOf(",")?b=!q.selector_complex.test(a)&&q.hash.test(a)?x.getElementById(a.replace(q.hash,""))||void 0:f.cast(x.querySelectorAll(a)):(b=[],f.each(l.explode(a),function(a){!q.selector_complex.test(a)&&q.hash.test(a)?(a=x.getElementById(a.replace(q.hash,
"")),null!==a&&b.push(a)):b=b.concat(f.cast(x.querySelectorAll(a)))})),b},alias:function(a,b){g.iterate(b,function(c,d){var e;c instanceof RegExp||"function"!==typeof c?c instanceof RegExp||c instanceof Array||!(c instanceof Object)?(e=function(a){b[d]=a},g.property(a,d,{enumerable:!0,get:function(){return b[d]},set:e,value:b[d]})):(void 0===a[d]&&(a[d]={}),g.alias(a[d],b[d])):a[d]=c.bind(a[d])});return a},clearTimers:function(a){if(void 0===a||a.isEmpty())throw Error(t.error.invalidArguments);void 0!==
g.timer[a]&&(clearTimeout(g.timer[a]),delete g.timer[a]);void 0!==g.repeating[a]&&(clearTimeout(g.repeating[a]),delete g.repeating[a])},clone:function(a){var b;return a instanceof Array?a.slice():"boolean"===typeof a?Boolean(a):"function"===typeof a?a:"number"===typeof a?Number(a):"string"===typeof a?String(a):a instanceof RegExp?a:!w&&!r.ie&&a instanceof Document?P.decode(P.encode(a)):null!==a&&void 0!==a&&"undefined"!==typeof a.__proto__?g.extend(a.__proto__,a):a instanceof Object?(b=H.encode(a,
!0),void 0!==b?(b=H.decode(b),g.iterate(a,function(a,d){"function"===typeof a&&(b[d]=a)})):b=a,b):a},coerce:function(a){a=g.clone(a);var b;l.isEmpty(a)?a=void 0:"undefined"===a?a=void 0:"null"===a?a=null:q.string_boolean.test(a)?a=q.string_true.test(a):(b=H.decode(a,!0))&&void 0!==b?a=b:null===a||(void 0===a||isNaN(Number(a)))||(a=Number(a));return a},compile:function(a,b,c){a.compile(b,c);return!0},css:function(a,b){var c,d;c=h.create("style",{type:"text/css",media:b||"print, screen"},g.$("head")[0]);
c.styleSheet?c.styleSheet.cssText=a:(d=x.createTextNode(a),c.appendChild(d));return c},debounce:function(a,b,c){if("function"!==typeof a)throw Error(t.error.invalidArguments);b=b||1E3;c=c||D;return function(){g.defer(function(){a.apply(c,arguments)},b)}},define:function(a,b,c){a=a.split(".");var d=c,e=a.length;void 0===c&&(c=this);void 0===b&&(b=null);f.each(a,function(c,g){var h=g+1<e&&!isNaN(u.parse(a[g+1],10)),l=b;isNaN(u.parse(c,10))||(c=u.parse(c,10));void 0===d[c]?d[c]=h?[]:{}:d[c]instanceof
Object&&h?d[c]=f.cast(d[c]):d[c]instanceof Object||(d[c]=d[c]instanceof Array&&!h?f.toObject(d[c]):{});g+1===e?d[c]=l:d=d[c]});return c},defer:function(a,b,c,d){b=b||0;c=c||g.uuid(!0);d=!0===d;g.clearTimers(c);g[d?"repeating":"timer"][c]=setTimeout(function(){g.clearTimers(c);a()},b);return c},domId:function(a){return"a"+a.replace(/-/g,"").slice(1)},error:function(a,b,c,d){d=!0===d;a={arguments:void 0!==b?f.cast(b):[],message:a.message||a,number:void 0!==a.number?a.number&65535:void 0,scope:c,stack:a.stack||
void 0,timestamp:(new Date).toUTCString(),type:a.type||"TypeError"};g.log(a.stack||a.message,d?"warn":"error");g.error.log.push(a);m.fire(M,"error",a)},extend:function(){return"function"===typeof Object.create?function(a,b){var c;if(void 0===a)throw Error(t.error.invalidArguments);c=Object.create(a);b instanceof Object&&g.merge(c,b);return c}:function(a,b){function c(){}var d;if(void 0===a)throw Error(t.error.invalidArguments);c.prototype=a;d=new c;b instanceof Object&&g.merge(d,b);return d}}(),genId:function(a,
b){var c;if(void 0!==a&&(void 0!==a.id&&""!==a.id||a instanceof Array||a instanceof String||"string"===typeof a))return a;if(!0===b){do c=g.domId(g.uuid(!0));while(void 0!==g.$("#"+c))}else c=g.domId(g.uuid(!0));return"object"===typeof a?(a.id=c,a):c},hex:function(a){var b,c;if("#"!==a.charAt(0)){b=l.explode(a.replace(/.*\(|\)/g,""));a=u.parse(b[0]||0);c=u.parse(b[1]||0);b=u.parse(b[2]||0);a=(b|c<<8|a<<16).toString(16);if(6>a.length)for(b=u.diff(a.length,6),c=-1;++c<b;)a="0"+a;a="#"+a}return a},iterate:function(){return"function"===
typeof Object.keys?function(a,b){if("function"!==typeof b)throw Error(t.error.invalidArguments);f.each(Object.keys(a),function(c){return b.call(a,a[c],c)});return a}:function(a,b){var c=Object.prototype.hasOwnProperty,d,e;if("function"!==typeof b)throw Error(t.error.invalidArguments);for(d in a)if(c.call(a,d)){if(e=b.call(a,a[d],d),!1===e)break}else break;return a}}(),loading:function(a){var b=M.loading;a=g.object(a);if(a instanceof Array)return f.each(a,function(a){g.loading(a)});if(null===b.url||
void 0===a)throw Error(t.error.invalidArguments);void 0===b.image&&(b.image=new Image,b.image.src=b.url);h.clear(a);h.create("img",{alt:t.common.loading,src:b.image.src},h.create("div",{"class":"loading"},a));return a},log:function(a,b){var c;"undefined"!==typeof console&&(c="object"!==typeof a?"["+(new Date).toLocaleTimeString()+"] "+a:a,console[b||"log"](c))},merge:function(a,b){g.iterate(b,function(b,d){a[d]instanceof Array&&b instanceof Array?f.merge(a[d],b):a[d]instanceof Object&&b instanceof
Object?g.iterate(b,function(b,c){a[d][c]=g.clone(b)}):a[d]=g.clone(b)});return a},module:function(a,b){if(void 0!==B[a]||!b instanceof Object)throw Error(t.error.invalidArguments);B[a]=b;return B[a]},object:function(a){return"object"===typeof a?a:"#"===a.toString().charAt(0)?g.$(a):a},parse:function(a){var b={},c={};void 0===a&&(a=w?"":O.href);w?b=ba.parse(a):(b=x.createElement("a"),b.href=a);w&&g.iterate(b,function(a,c){null===a&&(b[c]=void 0)});c={auth:w?null:q.auth.exec(a),protocol:b.protocol||
"http:",hostname:b.hostname||"localhost",port:l.isEmpty(b.port)?"":u.parse(b.port,10),pathname:b.pathname,search:b.search||"",hash:b.hash||"",host:b.host||"localhost"};r.ie&&(":"===c.protocol&&(c.protocol=O.protocol),l.isEmpty(c.hostname)&&(c.hostname=O.hostname),l.isEmpty(c.host)&&(c.host=O.host),"/"!==c.pathname.charAt(0)&&(c.pathname="/"+c.pathname));c.auth=b.auth||(null===c.auth?"":c.auth[1]);c.href=b.href||c.protocol+"//"+(l.isEmpty(c.auth)?"":c.auth+"@")+c.host+c.pathname+c.search+c.hash;c.path=
b.path||c.pathname+c.search;c.query=g.queryString(null,c.search);return c},property:function(){return(w||!r.ie||8<r.version)&&"function"===typeof Object.defineProperty?function(a,b,c){if(!(c instanceof Object))throw Error(t.error.invalidArguments);void 0!==c.value&&void 0!==c.get&&delete c.value;Object.defineProperty(a,b,c)}:function(a,b,c){if(!(c instanceof Object))throw Error(t.error.invalidArguments);a[b]=c.value;return a}},proto:function(a,b){g.iterate(ha[b],function(b,d){g.property(a.prototype,
d,{value:b,configurable:!0,writable:!0})});return a},queryString:function(a,b){var c={},d=void 0!==b?-1<b.indexOf("?")?b.replace(/.*\?/,""):null:w||l.isEmpty(O.search)?null:O.search.replace("?",""),e;null===d||l.isEmpty(d)||(d=d.split("&"),f.each(d,function(a){e=a.split("=");l.isEmpty(e[0])||(void 0===e[1]||l.isEmpty(e[1])?e[1]="":l.isNumber(e[1])?e[1]=Number(e[1]):l.isBoolean(e[1])&&(e[1]="true"===e[1]),void 0===c[e[0]]?c[e[0]]=e[1]:(c[e[0]]instanceof Array||(c[e[0]]=[c[e[0]]]),c[e[0]].push(e[1])))}));
null!==a&&void 0!==a&&(c=c[a]);return c},reflect:function(a){void 0===a&&(a=this||g.$);a=a.toString().match(q.reflect)[1];return l.explode(a)},repeat:function(a,b,c,d){b=b||10;c=c||g.uuid(!0);if(!1===d||!1!==a())return g.defer(function(){var d=function(a,b,c){var d=this;!1!==a()?g.repeating[c]=setTimeout(function(){d.call(d,a,b,c)},b):delete g.repeating[c]};d.call(d,a,b,c)},b,c,!0),c},script:function(a,b,c){return h.create("script",{type:"application/javascript",src:a},b||g.$("head")[0],c)},stylesheet:function(a,
b){return h.create("link",{rel:"stylesheet",type:"text/css",href:a,media:b||"print, screen"},g.$("head")[0])},stop:function(a){void 0!==a.cancelBubble&&(a.cancelBubble=!0);"function"===typeof a.preventDefault&&a.preventDefault();"function"===typeof a.stopPropagation&&a.stopPropagation();a.returnValue=!1;return a},target:function(a){return a.target||a.srcElement},tpl:function(a,b){var c;if("object"!==typeof a||!q.object_undefined.test(typeof b)&&void 0===(b="#"===b.charAt(0)?g.$(b):g.$(b)[0]))throw Error(t.error.invalidArguments);
void 0===b&&(b=g.$("body")[0]);c=x.createDocumentFragment();a instanceof Array?f.each(a,function(a){h.html(h.create(f.cast(a,!0)[0],c),f.cast(a)[0])}):g.iterate(a,function(a,b){"string"===typeof a?h.html(h.create(b,void 0,c),a):(a instanceof Array||a instanceof Object)&&g.tpl(a,h.create(b,void 0,c))});b.appendChild(c);return f.last(b.childNodes)},uuid:function(a){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},c=[8,9,"a","b"],b=b()+b()+"-"+b()+"-4"+b().substr(0,3)+"-"+
c[Math.floor(Math.random()*c.length)]+b().substr(0,3)+"-"+b()+b()+b();!0===a&&(b=b.replace(/-/g,""));return b},walk:function(a,b){f.each(b.replace(/\]$/,"").replace(/\]/g,".").split(/\.|\[/),function(b){a=a[b]});return a},when:function(){var a=0,b=I.factory(),c=f.cast(arguments),d;c[0]instanceof Array&&(c=c[0]);d=c.length;0===d?b.resolve(null):f.each(c,function(e){e.then(function(){++a!==d||b.isResolved()||(1<c.length?b.resolve(c.map(function(a){return a.outcome||a.promise.outcome})):b.resolve(c[0].outcome||
c[0].promise.outcome))},function(){b.isResolved()||(1<c.length?b.reject(c.map(function(a){return a.outcome||a.promise.outcome})):b.reject(c[0].outcome||c[0].promise.outcome))})});return b}},K={test:function(a){var b=!1,c=[],d=null,e=[],k;void 0!==a.nodeName&&"FORM"===a.nodeName?(l.isEmpty(a.id)&&g.genId(a),e=g.$("#"+a.id+" input, #"+a.id+" select"),f.each(e,function(a){var d={},e,f;e=q[a.nodeName.toLowerCase()]?q[a.nodeName.toLowerCase()]:!l.isEmpty(a.id)&&q[a.id.toLowerCase()]?q[a.id.toLowerCase()]:
"notEmpty";f=h.val(a);null===f&&(f="");d[e]=f;K.test(d).pass||(c.push({element:a,test:e,value:f}),b=!0)})):g.iterate(a,function(a,e){void 0===a||null===a?(c.push({test:e,value:a}),b=!0):(d="#"===a.toString().charAt(0)?void 0!==g.$(a)?h.val(g.$(a)):"":a,"date"===e?isNaN((new Date(d)).getYear())&&(c.push({test:e,value:d}),b=!0):"domain"===e?q.domain.test(d.replace(q.scheme,""))||(c.push({test:e,value:d}),b=!0):"domainip"===e?q.domain.test(d.replace(q.scheme,""))&&q.ip.test(d)||(c.push({test:e,value:d}),
b=!0):(k=q[e]||e,k.test(d)||(c.push({test:e,value:d}),b=!0)))});return{pass:!b,invalid:c}}},ia=function(){var a=/2|3/,b,c,d,e,h;c={"User-Agent":"abaaso/3.8.16 node.js/"+process.versions.node.replace(/^v/,"")+" ("+l.capitalize(process.platform)+" V8/"+process.versions.v8+" )","Content-Type":"text/plain",Accept:"*/*"};h=function(a){this.readyState!==a&&(this.readyState=a,this.dispatchEvent("readystatechange"),4!==this.readyState||this._error||(this.dispatchEvent("load"),this.dispatchEvent("loadend")));
return this};d=function(a){var b=this;h.call(this,2);this.status=a.statusCode;this._resheaders=a.headers;void 0!==this._resheaders["set-cookie"]&&this._resheaders["set-cookie"]instanceof Array&&(this._resheaders["set-cookie"]=this._resheaders["set-cookie"].join(";"));a.on("data",function(c){a.setEncoding("utf8");b._send&&(c&&(b.responseText+=c),h.call(b,3))});a.on("end",function(){b._send&&(h.call(b,4),b._send=!1)});a.on("close",function(a){e.call(b,a)})};e=function(a){this.status=503;this.statusText=
a;this.responseText=void 0!==a?a.stack||a:a;this._error=!0;this.dispatchEvent("error");h.call(this,4)};b=function(){this.onreadystatechange=this.onloadstart=this.onloadend=this.onload=this.onerror=this.onabort=null;this.readyState=0;this.response=null;this.responseType=this.responseText="";this.responseXML=null;this.status=0;this.statusText="";this._id=g.genId();this._error=!1;this._headers={};this._listeners={};this._params={};this._request=null;this._resheaders={};this._send=!1};b.prototype.abort=
function(){null!==this._request&&(this._request.abort(),this._request=null);this.responseXML=this.responseText="";this._error=!0;this._headers={};if(!0===this._send||a.test(this.readyState))this._send=!1,h.call(this,4);this.dispatchEvent("abort");this.readyState=0;return this};b.prototype.addEventListener=function(a,b){this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]);this._listeners[a].add(b);return this};b.prototype.dispatchEvent=function(a){var b=this;if("function"===typeof this["on"+
a])this["on"+a]();this._listeners.hasOwnProperty(a)&&f.each(this._listeners[a],function(a){"function"===typeof a&&a.call(b)});return this};b.prototype.getAllResponseHeaders=function(){var a="";if(2>this.readyState||this._error)throw Error(t.error.invalidStateNoHeaders);g.iterate(this._resheaders,function(b,c){a+=c+": "+b+"\n"});return a};b.prototype.getResponseHeader=function(a){if(2>this.readyState||this._error)throw Error(t.error.invalidStateNoHeaders);return this._resheaders[a]||this._resheaders[a.toLowerCase()]};
b.prototype.open=function(a,b,d,e,f){var h=this;if(void 0!==d&&!0!==d)throw Error(t.error.invalidStateNoSync);this.abort();this._error=!1;this._params={method:a,url:b,async:d||!0,user:e||null,password:f||null};g.iterate(c,function(a,b){h._headers[b]=a});this.readyState=1;return this};b.prototype.overrideMimeType=function(a){this._headers["Content-Type"]=a;return this};b.prototype.removeEventListener=function(a,b){if(this._listeners.hasOwnProperty(a))return this._listeners[a].remove(b),this};b.prototype.send=
function(a){a=a||null;var b=this,c,f;if(1>this.readyState)throw Error(t.error.invalidStateNotOpen);if(this._send)throw Error(t.error.invalidStateNotSending);f=g.parse(this._params.url);f.port=f.port||("https:"===f.protocol?443:80);null!==this._params.user&&null!==this._params.password&&(f.auth=this._params.user+":"+this._params.password);q.put_post.test(this._params.method)&&(this._headers["Content-Length"]=null!==a?Buffer.byteLength(a):0);this._headers.Host=f.hostname+(q.http_ports.test(f.port)?
"":":"+f.port);c={hostname:f.hostname,path:f.path,port:f.port,method:this._params.method,headers:this._headers};"https:"===f.protocol&&(c.rejectUnauthorized=!1,c.agent=!1);void 0!==f.auth&&(c.auth=f.auth);b._send=!0;b.dispatchEvent("readystatechange");c=("http:"===f.protocol?U:V).request(c,function(a){d.call(b,a)}).on("error",function(a){e.call(b,a)});null===a?c.setSocketKeepAlive(!0,1E4):c.write(a,"utf8");this._request=c;c.end();b.dispatchEvent("loadstart");return this};b.prototype.setRequestHeader=
function(a,b){if(1!==this.readyState)throw Error(t.error.invalidStateNotUsable);if(this._send)throw Error(t.error.invalidStateNotSending);this._headers[a]=b;return this};return b},P={decode:function(){return w||!r.ie||8<r.version?function(a){if("string"!==typeof a||l.isEmpty(a))throw Error(t.error.invalidArguments);return(new DOMParser).parseFromString(a,"text/xml")}:function(a){var b;if("string"!==typeof a||l.isEmpty(a))throw Error(t.error.invalidArguments);b=new ActiveXObject("Microsoft.XMLDOM");
b.async="false";b.loadXML(a);return b}}(),encode:function(a,b){try{if(void 0===a)throw Error(t.error.invalidArguments);var c=(b=!1!==b)?"<xml>":"",d=!1!==arguments[2],e;e=function(a,b){var c;c="<n>v</n>".replace("v",q.cdata.test(b)?"<![CDATA["+b+"]]\x3e":b);return c.replace(/<(\/)?n>/g,"<$1"+a+">")};null!==a&&void 0!==a.xml&&(a=a.xml);a instanceof Document&&(a=(new XMLSerializer).serializeToString(a));q.boolean_number_string.test(typeof a)?c+=e("item",a):"object"===typeof a&&g.iterate(a,function(a,
b){c+=P.encode(a,"object"===typeof a,!1).replace(/item|xml/g,isNaN(b)?b:"item")});c+=b?"</xml>":"";d&&(c='<?xml version="1.0" encoding="UTF8"?>'+c);return c}catch(f){g.error(f,arguments,this)}},valid:function(){return w||!r.ie||8<r.version?function(a){return 0===P.decode(a).getElementsByTagName("parsererror").length}:function(a){return 0===P.decode(a).parseError.errorCode}}()};return{array:f,callback:{},client:{activex:r.activex,android:r.android,blackberry:r.blackberry,chrome:r.chrome,firefox:r.firefox,
ie:r.ie,ios:r.ios,linux:r.linux,mobile:r.mobile,opera:r.opera,osx:r.osx,playbook:r.playbook,safari:r.safari,tablet:r.tablet,size:{height:0,width:0},version:0,webos:r.webos,windows:r.windows,del:function(a,b,c,d,e){return r.request(a,"DELETE",b,c,null,d,e)},get:function(a,b,c,d,e){return r.request(a,"GET",b,c,null,d,e)},headers:function(a,b,c,d){return r.request(a,"HEAD",b,c,null,null,d)},patch:function(a,b,c,d,e,f){return r.request(a,"PATCH",b,c,d,e,f)},post:function(a,b,c,d,e,f){return r.request(a,
"POST",b,c,d,e,f)},put:function(a,b,c,d,e,f){return r.request(a,"PUT",b,c,d,e,f)},jsonp:function(a,b,c,d){return r.jsonp(a,b,c,d)},options:function(a,b,c,d){return r.request(a,"OPTIONS",b,c,null,null,d)},permissions:r.permissions},cookie:fa,element:h,json:H,label:t,loading:{create:g.loading,url:null},message:{clear:function(a){return m.remove(D,"message","message",a||"all")},send:function(a,b){try{a.postMessage(b,"*")}catch(c){g.error(c,arguments,this)}return a},recv:function(a,b){return m.add(D,
"message",a,"message",D,b||"all")}},mouse:G,number:u,regex:q,route:{enabled:!1,current:v.current,del:v.del,hash:v.hash,init:v.init,initial:v.initial,list:v.list,load:v.load,reset:v.reset,server:v.server,set:v.set},state:{},string:l,xml:P,alias:g.alias,aliased:"abaaso",allows:r.allows,append:function(a,b,c){c instanceof Element&&c.genId();return h.create(a,b,c,"last")},bootstrap:function(){var a=this,b,c;b=function(a){m.remove(a);f.each(f.cast(a.childNodes),function(a){b(a)})};c=function(){if(q.complete_loaded.test(x.readyState))return"function"===
typeof a.init&&a.init.call(a),!1};delete this.bootstrap;this.error.log=[];z.delay=z.delay();if(w)this.array.cast=f.cast(),this.property=g.property=g.property(),XMLHttpRequest=ia();else{this.client.size=r.size();this.client.version=r.version=r.version();this.client.mobile=r.mobile.call(this);this.client.tablet=r.tablet.call(this);if(r.ie&&8>r.version)throw Error(t.error.upgrade);this.array.cast=f.cast();this.mouse.view=G.view();this.property=g.property=g.property();void 0===Array.prototype.filter&&
(Array.prototype.filter=function(a,b){b=b||this;var c=[];if(void 0===b||null===b||"function"!==typeof a)throw Error(t.error.invalidArguments);f.each(b,function(f){a.call(b,f)&&c.push(f)});return c});void 0===Array.prototype.forEach&&(Array.prototype.forEach=function(a,b){b=b||this;if(null===this||"function"!==typeof a)throw Error(t.error.invalidArguments);f.each(b,function(c){a.call(b,c)})});void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(a,b){var c=this.length>>0,f=(b||0)-1;if(void 0===
this||null===this||void 0===a)throw Error(t.error.invalidArguments);for(;++f<c;)if(this[f]===a)return f;return-1});void 0===Array.prototype.map&&(Array.prototype.map=function(a,b){b=b||this;var c=[];if(void 0===b||null===b||"function"!==typeof a)throw Error(t.error.invalidArguments);f.each(b,function(f){c.push(a.call(b,f))});return c});void 0===Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){var c=this.length>>0,f=0;if(void 0===this||null===this||"function"!==typeof a)throw Error(t.error.invalidArguments);
if(void 0===b){if(0===c)throw Error(t.error.invalidArguments);b=this[0];f=1}for(f--;++f<c;)b=a.call(this,b,this[f]);return b});void 0===x.documentElement.classList&&function(a){var b,c,g;if("HTMLElement"in a||"Element"in a)if(b=function(a){var b=l.isEmpty(a.className)?[]:a.className.explode(" "),c=this;f.each(b,function(a){c.push(a)});this.updateClassName=function(){a.className=this.join(" ")}},c=function(){return new b(this)},g=b.prototype=[],a=(a.HTMLElement||a.Element).prototype,g.add=function(a){f.contains(this,
a)||(this.push(a),this.updateClassName())},g.contains=function(a){return f.contains(this,a)},g.remove=function(a){f.contains(this,a)&&(f.remove(this,a),this.updateClassName())},g.toggle=function(a){f[f.contains(this,a)?"remove":"add"](this,a);this.updateClassName()},Object.defineProperty)c={get:c,enumerable:!r.ie||8<r.version?!0:!1,configurable:!0},Object.defineProperty(a,"classList",c);else if(Object.prototype.__defineGetter__)a.__defineGetter__("classList",c);else throw Error("Could not create classList shim");
}(D);void 0===Function.prototype.bind&&(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,f=c.call(arguments,1);return function(){return b.apply(a,f.concat(c.call(arguments)))}})}B=g.$;g.merge(B,this);delete B.init;delete B.loading;v.reset();g.proto(Array,"array");"undefined"!==typeof Element&&g.proto(Element,"element");r.ie&&8===r.version&&g.proto(HTMLDocument,"element");g.proto(Function,"function");g.proto(Number,"number");g.proto(String,"string");w||(m.add(D,"error",function(a){m.fire(M,
"error",a)},"error",D,"all"),m.add(D,"hashchange",function(){var b=O.hash.replace(/^\#\!?|\?.*|\#.*/g,"");if(B.route.current!==b||a.route.current!==b)a.route.current=b,B.route.current!==a.route.current&&(B.route.current=a.route.current),m.fire(M,"beforeHash, hash, afterHash",O.hash)},"hash",D,"all"),m.add(D,"resize",function(){B.client.size=a.client.size=r.size();m.fire(M,"resize",a.client.size)},"resize",D,"all"),m.add(D,"load",function(){m.fire(M,"render");m.remove(M,"render");m.remove(this,"load")}),
"function"===typeof Object.observe&&m.add(D,"DOMNodeInserted",function(a){var b=g.target(a);Object.observe(b,function(a){m.fire(b,"change",a)})},"mutation",D,"all"),m.add(D,"DOMNodeRemoved",function(a){var c=g.target(a);void 0!==c.id&&(!l.isEmpty(c.id)&&a.relatedNode instanceof Element)&&b(c)},"mutation",D,"all"),m.add(M,"hash",function(b){(B.route.enabled||a.route.enabled)&&v.load(b)},"route",this.route,"all"));!r.ie||8<r.version?(g.property(this.state,"current",{enumerable:!0,get:F.getCurrent,set:F.setCurrent}),
g.property(this.state,"previous",{enumerable:!0,get:F.getPrevious,set:F.setPrevious}),g.property(this.state,"header",{enumerable:!0,get:F.getHeader,set:F.setHeader}),g.property(B.state,"current",{enumerable:!0,get:F.getCurrent,set:F.setCurrent}),g.property(B.state,"previous",{enumerable:!0,get:F.getPrevious,set:F.setPrevious}),g.property(B.state,"header",{enumerable:!0,get:F.getHeader,set:F.setHeader})):(B.state.current=this.state.current=this.state._current,B.state.change=this.state.change=function(b){return a.state.current=
F.setCurrent(b)},B.state.setHeader=this.state.setHeader=function(b){return a.state.header=F.setHeader(b)});B.ready=this.ready=!0;"undefined"!==typeof exports||"function"==typeof define||q.complete_loaded.test(x.readyState)?this.init():"function"===typeof x.addEventListener?x.addEventListener("DOMContentLoaded",function(){a.init.call(a)},!1):"function"===typeof x.attachEvent?x.attachEvent("onreadystatechange",c):g.repeat(c)},clear:h.clear,clearTimer:g.clearTimers,clone:g.clone,coerce:g.coerce,compile:g.compile,
create:h.create,css:g.css,data:T.decorator,datalist:S.factory,discard:function(a){return m.discard(a)},debounce:g.debounce,decode:H.decode,defer:I.factory,define:g.define,del:function(a,b,c,d,e){return r.request(a,"DELETE",b,c,null,d,e)},delay:g.defer,destroy:h.destroy,encode:H.encode,error:g.error,expire:y.clean,expires:12E4,fib:f.fib,extend:g.extend,filter:ga.factory,fire:function(a,b){var c="object"===typeof a,c=[c?a:this,c?b:a].concat(f.cast(arguments).remove(0,c?1:0));return m.fire.apply(m,c)},
genId:g.genId,get:function(a,b,c,d,e){return r.request(a,"GET",b,c,null,d,e)},grid:function(a,b,c,d,e,f,g){return(new $(a,b,c,d,e,f)).init(g)},guid:function(){return g.uuid().toUpperCase()},hash:v.hash,headers:function(a,b,c,d){return r.request(a,"HEAD",b,c,null,{},d)},hex:g.hex,hidden:h.hidden,hook:m.decorate,id:"abaaso",init:function(){delete M.init;g.repeat(function(){y.clean()},6E4,"cacheGarbageCollector");return m.fire(this,"init, ready").un(this,"init, ready")},iterate:g.iterate,jsonp:function(a,
b,c,d){return r.jsonp(a,b,c,d)},listeners:function(a,b){return m.list("object"===typeof a?a:this,b)},listenersTotal:m.sum,log:g.log,logging:m.log,lru:function(a){var b=new aa;isNaN(a)||(b.max=a);return b},merge:g.merge,module:g.module,object:g.object,observerable:m.decorate,on:function(a,b,c,d,e,f){var g;"object"===typeof a?(g=a,a=b,b=c,c=d,d=e,e=f):g=this;void 0===d&&(d=g);return m.add(g,a,b,c,d,e)},once:function(a,b,c,d,e,f){var g;"object"===typeof a?(g=a,a=b,b=c,c=d,d=e,e=f):g=this;void 0===d&&
(d=g);return m.once(g,a,b,c,d,e)},options:function(a,b,c,d){return r.request(a,"OPTIONS",b,c,null,null,d)},parse:g.parse,patch:function(a,b,c,d,e,f){return r.request(a,"PATCH",b,c,d,e,f)},pause:function(a){return m.pause(!1!==a)},permissions:r.permissions,position:h.position,post:function(a,b,c,d,e,f){return r.request(a,"POST",b,c,d,e,f)},prepend:function(a,b,c){c instanceof Element&&c.genId();return h.create(a,b,c,"first")},promise:z.factory,property:g.property,put:function(a,b,c,d,e,f){return r.request(a,
"PUT",b,c,d,e,f)},queryString:function(a,b){return g.queryString(a,b)},random:u.random,ready:!1,reflect:g.reflect,repeat:g.repeat,repeating:function(){return f.keys(g.repeating)},stylesheet:g.stylesheet,script:g.script,stop:g.stop,store:T.decorator,target:g.target,tpl:g.tpl,un:function(a,b,c,d){var e;"object"===typeof a?(e=a,a=b,b=c,c=d):e=this;return m.remove(e,a,b,c)},update:h.update,uuid:g.uuid,validate:K.test,version:"3.8.16",walk:g.walk,when:g.when}}(),M.bootstrap(),"undefined"!==typeof exports?
module.exports=B:"function"===typeof define?define("abaaso",function(){return B}):D.abaaso=B)})(this);
//@ sourceMappingURL=abaaso.map
